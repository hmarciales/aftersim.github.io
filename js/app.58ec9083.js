(function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&d.push(n[s][0]),n[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],a=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(a=!1)}a&&(r.splice(t--,1),e=s(s.s=i[0]))}return e}var a={},n={app:0},r=[];function s(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=a,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(i,a,function(t){return e[t]}.bind(null,a));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;r.push([1,"chunk-vendors"]),i()})({0:function(e,t){},"0386":function(e,t,i){e.exports=i.p+"img/darkmode.a447d0e4.jpg"},"0554":function(e,t,i){"use strict";i.r(t),t["default"]="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nuniform float currentTime;\nvarying float vPercentComplete;\n\nvoid main(void) {\n\n  if (vPercentComplete == -1.0) discard;\n\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  // gl_FragColor = picking_filterPickingColor(gl_FragColor)\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"},"0b51":function(e,t,i){},"0c3c":function(e,t,i){"use strict";var a=i("3600"),n=i.n(a);n.a},"0f40":function(e,t,i){},1:function(e,t,i){e.exports=i("cd49")},1133:function(e,t,i){},"11f4":function(e,t,i){},"125f":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"light":"light","dark":"dark"},"de":{"light":"hell","dark":"dark"}}'),delete e.options._Ctor}},"18ab":function(e,t,i){},"1a8b":function(e,t,i){"use strict";var a=i("125f"),n=i.n(a);t["default"]=n.a},"1bf3":function(e,t,i){},"1ce1":function(e,t,i){e.exports=i.p+"img/thumb-v6.4c765466.png"},"1e0d":function(e,t,i){},2:function(e,t){},"23ef":function(e,t,i){},2653:function(e,t,i){"use strict";var a=i("6448"),n=i.n(a);n.a},"2baf":function(e,t,i){},3:function(e,t){},"301c":function(e,t,i){e.exports=i.p+"img/banner.7663a105.jpg"},"31ec":function(e,t,i){"use strict";var a=i("1133"),n=i.n(a);n.a},3352:function(e,t,i){"use strict";var a=i("23ef"),n=i.n(a);n.a},"34c5":function(e,t,i){},3600:function(e,t,i){},"36a2":function(e,t,i){"use strict";var a=i("2baf"),n=i.n(a);n.a},"378d":function(e,t,i){},4:function(e,t){},"44aa":function(e,t,i){},"469e":function(e,t,i){},5:function(e,t){},5176:function(e,t,i){"use strict";var a=i("44aa"),n=i.n(a);n.a},"55ea":function(e,t,i){},"57a3":function(e,t){var i='<h2 id="aftersim">aftersim</h2> <p>the model output browser and data visualizer from TU Berlin.</p> ';e.exports=i},5837:function(e,t){var i='<ul> <li>aftersim <strong><a href="https://aftersim.github.io/docs/">documentation and users guide</a></strong></li> <li>Source code available <a href="https://github.com/aftersim/aftersim.github.io">on Github</a></li> </ul> ';e.exports=i},5853:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"more-info":"For more information:","tagLine":"the model output browser and data visualizer from TU Berlin."},"de":{"more-info":"Für weitere Informationen:","tagLine":"Der Modellergebnis-Browser der TU Berlin."}}'),delete e.options._Ctor}},"5bf4":function(e,t,i){},"5c0b":function(e,t,i){"use strict";var a=i("9c0c"),n=i.n(a);n.a},6033:function(e,t,i){"use strict";var a=i("a98e"),n=i.n(a);n.a},"61bb6":function(e,t,i){},6448:function(e,t,i){},"66bf":function(e,t,i){"use strict";var a=i("1e0d"),n=i.n(a);n.a},"677a":function(e,t,i){"use strict";var a=i("469e"),n=i.n(a);n.a},"6b0c":function(e,t,i){e.exports=function(){return new Worker(i.p+"ec9dfcefcbf2d0d0fb37.worker.js")}},"700a":function(e,t,i){"use strict";var a=i("61bb6"),n=i.n(a);n.a},7061:function(e,t,i){},"73e1":function(e,t,i){},"750d":function(e,t,i){e.exports=i.p+"img/vsp-logo.291f5f73.png"},"780e":function(e,t,i){"use strict";var a=i("8594"),n=i.n(a);n.a},"78bf":function(e,t,i){},7942:function(e,t,i){"use strict";var a=i("a5bc"),n=i.n(a);n.a},"818f":function(e,t,i){var a=i("4719"),n=i("301c"),r=i("a7f5"),s=i("b944"),o=a(n),l=a(r),c=a(s),u='<img src="'+o+'"> <h3 id="episim-covid-19-virus-spreading-dynamics">Episim: COVID-19 virus spreading dynamics</h3> <p>This animation illustrates the <a href="https://covid-sim.info">MATSIM-Episim model</a> as it simulates the spread of COVID-19 disease through <strong>Berlin, Germany</strong> and the surrounding area.</p> <p>Each dot depicts a person, going about their day. The colors represent their disease status:</p> <div style="display:flex;flex-direction:column;margin-bottom:1rem"> <p style="margin-bottom:.4rem"><span style="background-color:#c8c800">&nbsp;&nbsp;&nbsp;&nbsp;</span> Susceptible and healthy</p> <p style="margin-bottom:.4rem"><span style="background-color:#30ffff">&nbsp;&nbsp;&nbsp;&nbsp;</span> Latently Infected</p> <p style="margin-bottom:.4rem"><span style="background-color:#c80032">&nbsp;&nbsp;&nbsp;&nbsp;</span> Contagious</p> <p style="margin-bottom:.4rem"><span style="background-color:#ff5532">&nbsp;&nbsp;&nbsp;&nbsp;</span> Showing Symptoms</p> <p style="margin-bottom:.4rem"><span style="background-color:#6e2878">&nbsp;&nbsp;&nbsp;&nbsp;</span> Seriously Sick</p> <p style="margin-bottom:.4rem"><span style="background-color:#141414">&nbsp;&nbsp;&nbsp;&nbsp;</span> Critical</p> <p style="margin-bottom:.4rem"><span style="background-color:#1a7a2c">&nbsp;&nbsp;&nbsp;&nbsp;</span> Recovered</p> </div> <p>You can select different days to see how the population&#39;s health shifts over time.</p> <p>This is a &quot;Base Case&quot; simulation for illustrative purposes. It shows what would have happened in Berlin if there had been no social distancing measures, no closing of schools and workplaces, etc.</p> <p>This illustration shows only a small sample of the total tripmaking in Berlin; while MATSim-Episim can model each agent individually, it is too much data to show on one screen in disaggregate form.</p> <h3 id="interesting-things-to-explore">Interesting things to explore</h3> <ul> <li><p>By day 14, new infections <span style="background-color:#30e6f0">&nbsp;&nbsp;&nbsp;&nbsp;</span> are quite noticeable throughout Berlin, and by day 18 they are everywhere in the city</p> </li> <li><p>By day 33, many recovered people <span style="background-color:#1e7846">&nbsp;&nbsp;&nbsp;&nbsp;</span> are apparent</p> </li> <li><p>By day 40, most of the new infections occur far outside the central urban area of Berlin.</p> </li> </ul> <h3 id="how-does-the-simulation-work">How does the simulation work?</h3> <p>The method used by MATSIM-Episim is available on the front page at <a href="https://matsim-vsp.github.io">https://matsim-vsp.github.io</a>. It is based on advanced human mobility models and virus infection dynamics taken from recent literature and publications.</p> <h3 id="for-more-information">For more information</h3> <p>Please email us at <a href="mailto:covid19@vsp.tu-berlin.de">covid19@vsp.tu-berlin.de</a> for more information.</p> <p>The main website is at <a href="https://covid-sim.info">matsim-vsp.github.io</a> is under heavy development as we build new versions of the Episim model.</p> <p>MATSim-Episim is freely available and open source, and can be downloaded at <a href="https://github.com/matsim-org/matsim-episim">https://github.com/matsim-org/matsim-episim</a>.</p> <h3 id="acknowledgements">Acknowledgements</h3> <p>This site and the MATSim-Episim model are developed at Technische Universität Berlin, by the Transport Systems Planning and Transport Telematics group, Institute for Land and Sea Transport (ILS) at TU Berlin. Professor Kai Nagel leads the team.</p> <p>This research supported by the <a href="https://bmbf.de">Bundesministerium für Bildung und Forschung</a> at the German Federal Goverment.</p> <p>Website and visulations built using <a href="https://vuejs.org">Vue</a> and <a href="https://threejs.org">Three.js</a>.</p> <hr> <img src="'+l+'" width="40%"> <br/> <br/> <img src="'+c+'" width="40%"> <br/> <br/> <br/> <br/> ';e.exports=u},"83c7":function(e,t,i){"use strict";var a=i("d429"),n=i.n(a);n.a},8594:function(e,t,i){},"85e2":function(e,t,i){e.exports=i.p+"img/v3-thumb.507b4f45.png"},8667:function(e,t,i){"use strict";var a=i("7061"),n=i.n(a);n.a},8838:function(e,t,i){"use strict";var a=i("0f40"),n=i.n(a);n.a},8863:function(e,t,i){},"8bf0":function(e,t,i){},"8d41":function(e,t,i){"use strict";var a=i("378d"),n=i.n(a);n.a},"90da":function(e,t,i){"use strict";var a=i("9bba"),n=i.n(a);n.a},"920e":function(e,t,i){"use strict";var a=i("18ab"),n=i.n(a);n.a},9668:function(e,t,i){"use strict";var a=i("34c5"),n=i.n(a);n.a},"9bba":function(e,t,i){},"9c0c":function(e,t,i){},a278:function(e,t,i){"use strict";i.r(t),t["default"]="// fragment shader: pixel colors\nuniform float simulationTime;\n\n// passed in from vertex shader:\nvarying float skip;\nvarying float atRest;\n\nvec4 getColor() {\n\n    if (atRest == 1.0) {\n        return vec4(0.0, 0.5, 0.2, 1.0);\n    }\n\n    return vec4(1.0, 1.0, 0.5, 1.0);\n}\n\n\nvoid main() {\n    // don't do anything if this trip is currently out of time bounds\n    if (skip == 1.0) {\n\n        gl_FragColor = vec4(0,0,0,0);\n\n    } else {\n\n        gl_FragColor = getColor();\n\n    }\n}\n"},a5bc:function(e,t,i){},a722:function(e,t,i){"use strict";var a=i("11f4"),n=i.n(a);n.a},a7f5:function(e,t,i){e.exports=i.p+"img/matsim-logo-blue.33e6b1c3.png"},a98e:function(e,t,i){},ab71:function(e,t,i){"use strict";var a=i("d352"),n=i.n(a);t["default"]=n.a},acace:function(e,t,i){"use strict";var a=i("ef1a"),n=i.n(a);n.a},aeb6:function(e,t,i){e.exports=i.p+"img/logo-bmvi.28230675.png"},b8ce:function(e,t,i){"use strict";var a=i("73e1"),n=i.n(a);n.a},b944:function(e,t,i){e.exports=i.p+"img/tu-logo.e3c4ff96.png"},b950:function(e,t,i){"use strict";var a=i("78bf"),n=i.n(a);n.a},beb0:function(e,t,i){"use strict";var a=i("0b51"),n=i.n(a);n.a},c162:function(e,t,i){e.exports=function(){return new Worker(i.p+"dc44f05d74798c8356d8.worker.js")}},c454:function(e,t,i){},cc69:function(e,t,i){"use strict";var a=i("8bf0"),n=i.n(a);n.a},cd49:function(e,t,i){"use strict";i.r(t);i("2ca0"),i("e260"),i("e6cf"),i("cca6"),i("a79d");var a,n,r=i("2b0e"),s=i("a925"),o=(i("99af"),i("4ec9"),i("d3b7"),i("3ca3"),i("ddb0"),i("2f62"));(function(e){e["LightMode"]="light",e["DarkMode"]="dark"})(a||(a={})),function(e){e["Susceptible"]="susceptible",e["InfectedButNotContagious"]="infectedButNotContagious",e["Contagious"]="contagious"}(n||(n={}));var l,c={text:"#000",background:"#ccccc4",links:"#ffffff",susceptible:"#999900",infectedButNotContagious:"#0077ff",contagious:"#bb0044",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#000",recovered:"#116622"},u={text:"#fff",background:"#181518",links:"#445577",susceptible:"#bbbb44",infectedButNotContagious:"#00dddd",contagious:"#ff2299",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#fff",recovered:"#116622"};(function(e){e[e["line"]=0]="line",e[e["box"]=1]="box"})(l||(l={}));var h={projects:[{name:"Gallery",url:"gallery",description:"Example visualizations of public datasets.",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/viz-examples/examples",need_password:!1,thumbnail:"/thumb-examples.jpg"},{name:"zeroCUTS",url:"zerocuts",description:"zeroCUTS Project",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries/de/berlin/projects/zerocuts",need_password:!1,thumbnail:"/thumb-chart.jpg"},{name:"Public-SVN",url:"public-svn",description:"Simulation results from VSP at TU-Berlin",svn:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries",need_password:!1,thumbnail:"/thumb-chart.jpg"},{name:"Local Files",url:"local",description:"Run mini-file-server to browse files on your PC",svn:"http://localhost:8000",need_password:!1,thumbnail:"/thumb-localfiles.jpg"}]},d=h;r["default"].use(o["a"]);var p=new o["a"].Store({state:{debug:!0,authAttempts:0,breadcrumbs:[],credentials:{fake:"fake"},isFullScreen:!1,needLoginForUrl:"",statusMessage:"loading",svnProjects:d.projects,visualizationTypes:new Map,colorScheme:a.DarkMode,locale:"en"},getters:{},mutations:{requestLogin:function(e,t){e.needLoginForUrl=t},registerPlugin:function(e,t){console.log("PLUGIN:",t.kebabName),e.visualizationTypes.set(t.kebabName,t)},setBreadCrumbs:function(e,t){e.breadcrumbs=t},setCredentials:function(e,t){var i=btoa("".concat(t.username,":").concat(t.pw));e.credentials[t.url]=i,e.authAttempts++},setFullScreen:function(e,t){e.isFullScreen=t},setStatusMessage:function(e,t){e.statusMessage=t},rotateColors:function(e){e.colorScheme=e.colorScheme===a.DarkMode?a.LightMode:a.DarkMode,localStorage.setItem("colorscheme",e.colorScheme),console.log("NEW COLORS:",e.colorScheme)},setLocale:function(e,t){e.locale=t.toLocaleLowerCase(),localStorage.setItem("locale",e.locale),console.log("NEW LOCALE:",e.locale)}},actions:{},modules:{}}),m=i("b85c"),f=i("8c4f"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"home"}},[e._m(0),e._m(1),i("div",{staticClass:"page-area"},[i("div",{staticClass:"content"},[i("div",{staticClass:"main"},[i("div",{staticClass:"right",staticStyle:{"text-align":"right"}}),i("h1",[e._v("aftersim")]),i("h2",{staticClass:"readme"},[e._v(e._s(e.$t("tagLine")))]),i("svn-projects",{staticClass:"gap"}),i("h2",[e._v(e._s(e.$t("more-info")))]),i("div",{staticClass:"readme",domProps:{innerHTML:e._s(e.readmeBottom)}})],1)])])])},b=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"banner"},[i("h2",[e._v("aftersim")]),i("h3",[e._v("VSP / Technische Universität Berlin")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tu-logo"},[i("img",{staticClass:"img-logo",attrs:{src:"/tu-logo-circle.png"}})])}],g=i("d4ec"),y=i("bee2"),k=i("262e"),S=i("2caf"),w=i("9ab4"),O=i("60a3"),x=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},j=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"colophon-content"}},[a("div",{staticClass:"logo",staticStyle:{width:"100%"}},[a("a",{attrs:{href:"https://www.vsp.tu-berlin.de",target:"_blank"}},[a("img",{attrs:{src:i("b944")}})])]),a("div",{staticClass:"professor"},[e._v("Kai Nagel, Professor")]),a("div",{staticClass:"team"},[e._v("TU AVÖV Team")]),a("p",[e._v("Ihab Kaddoura")]),a("p",[e._v("Gregor Leich")]),a("p",[e._v("Billy Charlton")]),a("div",{staticClass:"team"},[e._v("Contact")]),a("p",{staticClass:"nonbreak"},[a("a",{attrs:{href:"mailto:sekretariat@vsp.tu-berlin.de"}},[e._v("Email")])]),a("div",{staticClass:"team"},[e._v("Projektpartner")]),a("div",{staticClass:"partners"},[a("p",[a("a",{attrs:{href:"https://www.uni-due.de/",target:"_blank"}},[e._v("Universität"),a("br"),e._v("Duisburg-Essen")])]),a("p",[a("a",{attrs:{href:"https://www.bvg.de/",target:"_blank"}},[e._v("Berliner Verkehrsbetriebe (BVG)")])]),a("p",[a("a",{attrs:{href:"https://senozon.com",target:"_blank"}},[e._v("Senozon Deutschland GmbH")])])]),a("a",{attrs:{href:"https://www.bmvi.de",target:"_blank"}},[a("img",{attrs:{src:i("aeb6")}})])])}],C={name:"Colophon",components:{}},T=C,_=(i("8667"),i("2877")),R=Object(_["a"])(T,x,j,!1,null,"5f22def3",null),E=R.exports,A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"card"},[i("div",{staticClass:"card-image",style:{"background-image":"url("+e.thumbnail+")"}}),i("div",{staticClass:"card-title"},[e._v(e._s(e.viz.title))]),i("div",{staticClass:"card-id"},[i("div",{staticClass:"card-endnotes"},[e._v(e._s(e.vizNumber))])]),i("div",{staticClass:"card-subtitle"},[e._v(e._s(e.viz.subtitle))]),i("div",{staticClass:"card-date"},[e._v(e._s(e.viz.date))])])},L=[],M=(i("c975"),i("fb6a"),function(e){Object(k["a"])(a,e);var t=Object(S["a"])(a);function a(){return Object(g["a"])(this,a),t.apply(this,arguments)}return Object(y["a"])(a,[{key:"vizNumber",get:function(){return this.viz.url.slice(1)}},{key:"thumbnail",get:function(){if(this.viz.url.indexOf("v3")>-1){var e=i("85e2");return e}if(this.viz.url.indexOf("timelapse")>-1){var t=i("85e2");return t}var a=i("1ce1");return a}}]),a}(O["c"]));Object(w["a"])([Object(O["b"])({required:!0})],M.prototype,"viz",void 0),M=Object(w["a"])([Object(O["a"])({props:{viz:{}}})],M);var F=M,P=F,D=(i("d469"),Object(_["a"])(P,A,L,!1,null,"7b286f98",null)),z=D.exports,I=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"svn-projects"},e._l(e.sources,(function(t){return i("div",{key:t.url,staticClass:"project",on:{click:[function(i){return e.openProjectPage(t)},function(i){return i.metaKey?e.openProjectTab(t):null},function(i){return i.ctrlKey?e.openProjectTab(t):null}],mouseup:function(i){return"button"in i&&1!==i.button?null:e.openProjectTab(t)}}},[i("img",{attrs:{src:t.thumbnail}}),i("div",{staticClass:"desc"},[i("h3",[e._v(e._s(t.name))]),i("p",[e._v(e._s(t.description))])])])})),0)},N=[],B=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.sources=[],e}return Object(y["a"])(i,[{key:"mounted",value:function(){this.sources=p.state.svnProjects}},{key:"openProjectPage",value:function(e){this.$router.push({name:e.url})}},{key:"openProjectTab",value:function(e){window.open(e,"_blank")}}]),i}(O["c"]);B=Object(w["a"])([Object(O["a"])({components:{},props:{}})],B);var H=B,V=H,$=(i("700a"),Object(_["a"])(V,I,N,!1,null,"04a200b8",null)),q=$.exports,U=i("57a3"),Y=i("5837"),G=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.state=p.state,e.readme=U,e.readmeBottom=Y,e}return Object(y["a"])(i,[{key:"mounted",value:function(){var e=[{label:"aftersim",url:"/"}];p.commit("setBreadCrumbs",e)}}]),i}(O["c"]);G=Object(w["a"])([Object(O["a"])({components:{Colophon:E,SvnProjects:q,VizCard:z}})],G);var X=G,W=X,J=(i("e6d6"),i("d1ef")),Z=Object(_["a"])(W,v,b,!1,null,"56f82b0f",null);"function"===typeof J["default"]&&Object(J["default"])(Z);var K=Z.exports,Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"folder-browser"},[e.myState.svnProject?i("div",{staticClass:"stripe white"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"project-bar"},[i("div",{staticClass:"details"},[i("h2",[e._v(e._s(e.globalState.breadcrumbs[e.globalState.breadcrumbs.length-1].label))]),i("p",[e._v(e._s(e.myState.svnProject.name))])]),e._m(0)])])]):e._e(),e.myState.errorStatus?i("div",{staticClass:"stripe white details"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"badnews",domProps:{innerHTML:e._s(e.myState.errorStatus)}})])]):i("div",{staticClass:"stripe cream details"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"curated-sections"},[i("div",{staticClass:"readme-header"},[e.myState.readme?i("div",{staticClass:"curate-content markdown",domProps:{innerHTML:e._s(e.myState.readme)}}):e._e()]),e.myState.folders.length?i("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.$t("Folders")))]):e._e(),e.myState.folders.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"folder-table"},e._l(e.myState.folders,(function(t){return i("div",{key:t.name,staticClass:"folder",class:{fade:e.myState.isLoading},on:{click:function(i){return e.openOutputFolder(t)}}},[i("p",[i("i",{staticClass:"fa fa-folder-open"}),e._v(" "+e._s(t))])])})),0)]):e._e(),e.myState.vizes.length?i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("Analysis")))]):e._e(),e.myState.vizes.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"viz-table"},e._l(e.myState.vizes,(function(t,a){return i("div",{key:t.config,staticClass:"viz-grid-item",on:{click:function(t){return e.clickedVisualization(a)}}},[i("div",{staticClass:"viz-frame"},[i(t.component,{tag:"component",staticClass:"viz-frame-component",style:{"pointer-events":"image-view"===t.component?"auto":"none"},attrs:{yamlConfig:t.config,fileApi:e.myState.svnRoot,subfolder:e.myState.subfolder,thumbnail:!0},on:{title:function(t){return e.updateTitle(a,t)}}}),i("p",[e._v(e._s(t.title))])],1)])})),0)]):e._e(),e.myState.files.length?i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("Files")))]):e._e(),e.myState.files.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"file-table"},e._l(e.myState.files,(function(t){return i("div",{key:t,staticClass:"file",class:{fade:e.myState.isLoading}},[i("a",{attrs:{href:e.myState.svnProject.svn+"/"+e.myState.subfolder+"/"+t}},[e._v(e._s(t))])])})),0)]):e._e()])])])])},ee=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"logo"},[i("img",{attrs:{width:"150",src:"/tu-logo.png"}})])}],te=(i("4de4"),i("d81d"),i("b0c0"),i("ac1f"),i("1276"),i("96cf"),i("1da1")),ie=i("d4cd"),ae=i.n(ie),ne=i("d15e"),re=i("db05"),se=i.n(re),oe=i("8f3c"),le=i.n(oe),ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"carrier-viewer",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[e.thumbnail?e._e():i("div",{staticClass:"nav"},[e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():i("tour-viz",{staticClass:"anim",attrs:{shipments:e.shownShipments,shownRoutes:e.shownRoutes,stopMidpoints:e.stopMidpoints,paths:[],drtRequests:[],traces:[],colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.detailContent?i("collapsible-panel",{staticClass:"left-side",attrs:{darkMode:!0,direction:"left",width:"300"}},[i("h3",[e._v("Raw Details")]),i("div",{staticClass:"panel-items"},[i("div",{staticClass:"detail-list"},[i("pre",{staticStyle:{color:"#ccc","padding-right":"2rem"}},[e._v(e._s(e.detailContent))])])])]):e._e(),e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.vehicleId))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()],1)},ue=[],he=(i("7db0"),i("baa5"),i("ace4"),i("b64b"),i("8a79"),i("9911"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("4971")),de=i.n(he),pe=i("f206"),me=i("89ab"),fe=i.n(me),ve=i("e975"),be=i.n(ve),ge=i("595c"),ye=i.n(ge),ke=i("083c"),Se=i.n(ke),we=i("faeb"),Oe=i.n(we),xe=i("b562"),je=i("f908"),Ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.id))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()},Te=[],_e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer"},[i("div",{staticClass:"body",style:{order:"left"===e.direction?2:1,maxWidth:e.collapsed?0:e.width+"px"}},[e._t("default")],2),i("div",{staticClass:"xbutton",style:{order:"left"===e.direction?1:2,borderRadius:e.collapsed?"4px":"0px"},on:{click:e.handleClick}},[i("div",{staticClass:"rotate",style:{transform:"rotate("+(e.collapsed?180:360)+"deg)"}},[e._v(e._s("left"===e.direction?"<":">"))])])])},Re=[],Ee=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.collapsed=void 0!==e.initialCollapsed&&e.initialCollapsed,e}return Object(y["a"])(i,[{key:"handleClick",value:function(){this.collapsed=!this.collapsed}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!0})],Ee.prototype,"width",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ee.prototype,"initialCollapsed",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Ee.prototype,"direction",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Ee.prototype,"darkMode",void 0),Ee=Object(w["a"])([O["a"]],Ee);var Ae=Ee,Le=Ae,Me=(i("cc69"),Object(_["a"])(Le,_e,Re,!1,null,"71b04e22",null)),Fe=Me.exports,Pe=(i("a4d3"),i("e01a"),i("ab5b")),De=i.n(Pe);function ze(e){var t=e.items.map((function(e){return De.a.createElement("li",{key:e.value+e.value[0]},De.a.createElement("div",{style:{width:"100%",height:"".concat(Math.max(1,3*(1*e.value-1)+3),"px"),backgroundColor:"rgb(".concat(e.color,")")}}),e.label&&De.a.createElement("div",{style:{marginBottom:"0.5rem"}},e.label))}));return De.a.createElement("div",null,De.a.createElement("h4",{style:{color:"white",textAlign:"left",fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.8rem"}},e.title),De.a.createElement("p",null,e.description),De.a.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},t))}var Ie=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"vue-component"}},[i("vue-slider",e._b({staticClass:"slider",on:{dragging:e.dragging,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.sliderOptions,!1)),i("div",{staticClass:"buttons"},[i("div",{staticClass:"playpause",on:{click:e.toggleSimulation}},[e.isRunning?i("i",{staticClass:"button-icon fa fa-1x fa-pause"}):i("i",{staticClass:"button-icon fa fa-1x fa-play"})])])],1)},Ne=[],Be=i("3c87"),He=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.sliderOptions={min:0,max:1e6,clickable:!1,dotSize:30,duration:0,lazy:!0,tooltip:"active","tooltip-placement":"top","tooltip-formatter":function(t){return e.convertSecondsToClockTimeMinutes(t)}},e.pauseWhileDragging=!1,e}return Object(y["a"])(i,[{key:"toggleSimulation",value:function(){this.$emit("click")}},{key:"convertSecondsToClockTimeMinutes",value:function(e){var t=this.getSecondsFromSlider(e);try{var i=Be(t),a=("00"+i.minutes).slice(-2);return"".concat(i.hours,":").concat(a)}catch(n){return"00:00"}}},{key:"dragStart",value:function(){this.isRunning&&(this.pauseWhileDragging=!0,this.$emit("click"))}},{key:"dragEnd",value:function(){this.pauseWhileDragging&&this.$emit("click"),this.pauseWhileDragging=!1}},{key:"dragging",value:function(e){this.$emit("time",this.getSecondsFromSlider(e))}},{key:"onKeyPressed",value:function(e){"Space"===e.code&&this.toggleSimulation()}},{key:"getSecondsFromSlider",value:function(e){var t=(this.timeEnd-this.timeStart)*e/1e6;return t===this.timeEnd&&(t=this.timeEnd-1),t}},{key:"handleTimeChanged",value:function(){this.sliderValue=1e6*(this.currentTime-this.timeStart)/(this.timeEnd-this.timeStart)}},{key:"mounted",value:function(){window.addEventListener("keyup",this.onKeyPressed)}},{key:"beforeDestroy",value:function(){window.removeEventListener("keyup",this.onKeyPressed)}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!0})],He.prototype,"isRunning",void 0),Object(w["a"])([Object(O["b"])({required:!0})],He.prototype,"timeStart",void 0),Object(w["a"])([Object(O["b"])({required:!0})],He.prototype,"timeEnd",void 0),Object(w["a"])([Object(O["b"])({required:!0})],He.prototype,"currentTime",void 0),Object(w["a"])([Object(O["d"])("currentTime")],He.prototype,"handleTimeChanged",null),He=Object(w["a"])([Object(O["a"])({components:{VueSlider:de.a},props:{}})],He);var Ve=He,$e=Ve,qe=(i("6033"),Object(_["a"])($e,Ie,Ne,!1,null,"0661f5b0",null)),Ue=qe.exports,Ye=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"settings-panel-content"},[i("h4",[e._v("Ein-/Ausblenden")]),e._l(Object.keys(e.items),(function(t){return i("div",{key:t,staticClass:"row"},[i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.items[t],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(i){return e.$emit("click",t)}}}),i("label",[e._v(e._s(t))])],1)}))],2)},Ge=[],Xe=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!0})],Xe.prototype,"items",void 0),Xe=Object(w["a"])([Object(O["a"])({components:{ToggleButton:pe["ToggleButton"]}})],Xe);var We=Xe,Je=We,Ze=(i("feb2"),Object(_["a"])(Je,Ye,Ge,!1,null,"6d4919fe",null)),Ke=Ze.exports;be.a.insensitive=!0;var Qe=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.vizDetails={network:"",carriers:"",projection:"",title:"",description:"",thumbnail:"",center:[13.4,52.5]},e.colorScheme=a.DarkMode,e.searchTerm="",e.searchEnabled=!1,e.globalState=p.state,e.isDarkMode=e.colorScheme===a.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(y["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s,o,l,c,u,h,d,p,f,v,b,g,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=10;break}return this.selectedTour=null,e.abrupt("return");case 10:this.selectedTour=t,i=[],a=[],n=0,r=Object(m["a"])(t.plan),e.prev=15,o=function(){var e=s.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),r="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===r)return"continue";var o=[k.links[r][0],k.links[r][1]],l=[k.links[r][2],k.links[r][3]],c=[.5*(k.links[r][0]+k.links[r][2]),.5*(k.links[r][1]+k.links[r][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,count:n++,link:r,midpoint:c,label:"",details:u,ptFrom:o,ptTo:l})}},r.s();case 18:if((s=r.n()).done){e.next=24;break}if(l=o(),"continue"!==l){e.next=22;break}return e.abrupt("continue",22);case 22:e.next=18;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e["catch"](15),r.e(e.t0);case 29:return e.prev=29,r.f(),e.finish(29);case 32:for(c=0;c<a.length;c++){for(u="",h=0;h<c;h++)a[c].midpoint[0]===a[h].midpoint[0]&&a[c].midpoint[1]===a[h].midpoint[1]&&(u+=",".concat(h),",0"===u&&(u=",*"),a[c].label="");u+=",".concat(c),u=u.slice(1),"0"===u&&(u="*"),a[c].label=u}this.shipmentIdsInTour=i,d=ye()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),p=0,f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},v=t.routes.length>20?25:50,b=Object(m["a"])(t.routes),e.prev=39,b.s();case 41:if((g=b.n()).done){e.next=49;break}return y=g.value,this.addRouteToMap(t,y,a,d,p),p++,e.next=47,f(v);case 47:e.next=41;break;case 49:e.next=54;break;case 51:e.prev=51,e.t1=e["catch"](39),b.e(e.t1);case 54:return e.prev=54,b.f(),e.finish(54);case 57:this.stopMidpoints=a;case 58:case"end":return e.stop()}}),e,this,[[15,26,29,32],[39,51,54,57]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var r,s=[[this.links[t[0]][0],this.links[t[0]][1]]],o=Object(m["a"])(t);try{for(o.s();!(r=o.n()).done;){var l=r.value,c=[this.links[l][0],this.links[l][1]];c[0]===s[s.length-1][0]&&c[1]===s[s.length-1][1]||s.push(c),s.push([this.links[l][2],this.links[l][3]])}}catch(u){o.e(u)}finally{o.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:s,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,(null===(t=e.capabilities[0])||void 0===t||null===(i=t.vehicles[0])||void 0===i?void 0:i.vehicle)&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return be()(e,t)}))),this.shipments=this.processShipments(e),(null===(a=e.services[0])||void 0===a?void 0:a.service)&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return be()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(!(null===(t=e.plan[0])||void 0===t?void 0:t.tour))return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{id:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return be()(e.id,t.id)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];(null===(t=e.shipments[0])||void 0===t?void 0:t.shipment)&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return be()(e.id,t.id)})));try{var a,n=Object(m["a"])(i);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.fromX=.5*(this.links[r.from][0]+this.links[r.from][2]),r.fromY=.5*(this.links[r.from][1]+this.links[r.from][3]),r.toX=.5*(this.links[r.to][0]+this.links[r.to][2]),r.toY=.5*(this.links[r.to][1]+this.links[r.to][3])}}catch(s){n.e(s)}finally{n.f()}}catch(o){}return i}},{key:"swapTheme",value:function(){this.isDarkMode=this.colorScheme===a.DarkMode}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.colorScheme===a.DarkMode?t:e}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("globalState.colorScheme")],Qe.prototype,"swapTheme",null),Qe=Object(w["a"])([Object(O["a"])({components:{CollapsiblePanel:Fe,LegendColors:ze,PlaybackControls:Ue,SettingsPanel:Ke,ToggleButton:pe["ToggleButton"],VueSlider:de.a}})],Qe);var et=Qe,tt=et,it=(i("f30e"),i("ab71")),at=Object(_["a"])(tt,Ce,Te,!1,null,"25a40e2e",null);"function"===typeof it["default"]&&Object(it["default"])(at);var nt,rt=at.exports,st=(i("13d5"),i("25f0"),i("fb2c"),"initialize"),ot="error",lt="result",ct=(self,function(){function e(t){var i=this;Object(g["a"])(this,e),this.promises=new Map,this.worker=t,this.handleMessageDelegate=function(e){return i.handleWorkerMessage(e)},this.worker.addEventListener("message",this.handleMessageDelegate)}return Object(y["a"])(e,[{key:"destroy",value:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessageDelegate),this.worker.terminate())}},{key:"postAsyncWorkerMessage",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={call:{method:t,parameters:i},id:this.generatePromiseId()},a?this.worker.postMessage(n,a):this.worker.postMessage(n,[]),e.abrupt("return",new Promise((function(e,t){r.promises.set(n.id,{resolve:e,reject:t})})));case 3:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"handleWorkerMessage",value:function(e){Date.now();var t=e.data;switch(t.type){case ot:this.handleError(t);break;case lt:this.handleEvent(t);break;default:console.error("unknown message type: "+t.type)}}},{key:"handleError",value:function(e){console.error("Error in Worker: "+e.error),this.promises.has(e.id)&&(this.promises.get(e.id).reject(e.error),this.promises.delete(e.id))}},{key:"handleEvent",value:function(e){this.promises.has(e.id)&&(this.promises.get(e.id).resolve(e.result),this.promises.delete(e.id))}},{key:"generatePromiseId",value:function(){var e=new Uint32Array(8);return crypto.getRandomValues(e),e.reduce((function(e,t){return e+("0"+t.toString(16)).slice(-2)}),"")}}]),e}()),ut=i("d977"),ht=i.n(ut);(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(nt||(nt={}));var dt=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.call(this,new ht.a)}return Object(y["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(nt.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(nt.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(nt.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(st,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ct),pt=i("3835"),mt=i("50fd"),ft=i("ee06"),vt=i("2a18"),bt=i("f2b6"),gt=i("c98a"),yt=i("72db"),kt=i("9043"),St=i("3cd3"),wt=i("60a4"),Ot=i("5530"),xt=i("45eb"),jt=i("7e84"),Ct=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"initializeState",value:function(e){Object(xt["a"])(Object(jt["a"])(i.prototype),"initializeState",this).call(this,e),this.getAttributeManager().addInstanced({instanceOffset:{size:1,accessor:"getOffset"}})}},{key:"getShaders",value:function(){return Object(Ot["a"])(Object(Ot["a"])({},Object(xt["a"])(Object(jt["a"])(i.prototype),"getShaders",this).call(this)),{},{inject:{"vs:#decl":"\n            attribute float instanceOffset;\n            varying float offset;\n            ","vs:#main-start":"\n            offset = instanceOffset;\n            ","fs:#decl":"\n            varying float offset;\n            ","fs:#main-start":"\n            if (offset == 1.0 && vPathPosition.x < 0.0) {\n                discard;\n            }\n            if (offset == 2.0 && vPathPosition.x > 0.0) {\n                discard;\n            }\n            if (offset == 0.0 && abs(vPathPosition.x) > 0.5) {\n                discard;\n            }\n        "}})}}]),i}(yt["a"]);Ct.layerName="PathOffsetLayer",Ct.defaultProps={getOffset:{type:"accessor",value:0}};var Tt=i("8307"),_t={circle:{x:0,y:0,width:128,height:128,mask:!0},infoPin:{x:128,y:0,width:128,height:128,mask:!0},box:{x:128,y:128,width:128,height:128,mask:!1},vehicle:{x:0,y:128,width:128,height:128,mask:!1}},Rt="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Et=new ft["a"]({color:[255,255,255],intensity:1}),At=new vt["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),Lt=new bt["a"]({ambientLight:Et,pointLight:At}),Mt={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[Lt]},Ft={latitude:52.5,longitude:13.4,zoom:9,pitch:15,minZoom:1,maxZoom:23};function Pt(e){var t="mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex",i=e.shipments,a=e.shownRoutes,n=e.stopMidpoints,r=(e.settingsShowLayers,e.center),s=(e.searchEnabled,e.onClick),o=Mt,l=Object.assign({},Ft);l.latitude=r[1],l.longitude=r[0];var c=Object(Pe["useState"])({}),u=Object(pt["a"])(c,2),h=u[0],d=u[1],p=[];function m(){console.log(h),h.object?s(h.object.v):s(null)}function f(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;if(i.color)return De.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:n-30}},"Leg ",i.count+1);var r=20*Object.keys(i).length+32,s=n-30;return s+r>window.innerHeight&&(s=n-r),De.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:s}},De.a.createElement("table",{style:{fontSize:"0.8rem"}},De.a.createElement("tbody",null,De.a.createElement("tr",null,De.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold",textAlign:"right",paddingRight:"0.5rem"}},i.type," ",i.count,":"),De.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold"}}," ",i.id)),Object.keys(i.details).map((function(e){return De.a.createElement("tr",{key:e},De.a.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem",paddingTop:"0.2rem"}},e,":"),De.a.createElement("td",{style:{paddingTop:"0.2rem"}},i.details[e]))})))))}return p.push(new yt["a"]({id:"shipmentLocationDashedLine",data:n,getPath:function(e){return[e.ptFrom,e.ptTo]},getColor:[192,192,192],getOffset:2,opacity:1,widthMinPixels:4,rounded:!0,shadowEnabled:!1,pickable:!1,autoHighlight:!1,highlightColor:[255,255,255],parameters:{depthTest:!1},getDashArray:[3,2],dashJustified:!0,extensions:[new Tt["a"]({dash:!0})]})),p.push(new Ct({id:"deliveryroutes",data:a,getPath:function(e){return e.points},getColor:function(e){return e.color},getOffset:2,opacity:1,widthMinPixels:12,rounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:d,parameters:{depthTest:!1}})),p.push(new kt["a"]({id:"dest-circles",data:n,getIcon:function(e){return"circle"},getColor:function(e){return e.count?[255,255,255]:[255,255,0]},getPosition:function(e){return e.midpoint},getSize:function(e){return e.count?38:64},opacity:1,shadowEnabled:!0,noAlloc:!1,iconAtlas:"/icon-atlas-3.png",iconMapping:_t,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:d})),p.push(new St["a"]({id:"dest-labels",data:n,backgroundColor:[255,255,255],getColor:[0,0,0],getPosition:function(e){return e.midpoint},getText:function(e){return"".concat(e.label)},getTextAnchor:"middle",getSize:18,opacity:1,noAlloc:!1,sizeScale:1,pickable:!1,autoHighlight:!1})),p.push(new wt["a"]({id:"shipments",data:i,getSourcePosition:function(e){return[e.fromX,e.fromY]},getTargetPosition:function(e){return[e.toX,e.toY]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:2,opacity:.75,parameters:{depthTest:!1}})),De.a.createElement(gt["a"],{layers:p,effects:o.effects,pickingRadius:5,initialViewState:l,controller:!0,getCursor:function(){return"pointer"},onClick:m},De.a.createElement(mt["b"],{reuseMaps:!0,mapStyle:t,preventStyleDiffing:!0,mapboxApiAccessToken:Rt}),f({hoverInfo:h}))}i("466d"),i("5319");var Dt=function(){function e(t){Object(g["a"])(this,e),this.urlId=t.url,this.needsAuth=t.need_password,this.baseUrl=t.svn,t.svn.endsWith("/")||(this.baseUrl+="/")}return Object(y["a"])(e,[{key:"_getFileResponse",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this.baseUrl+t.replace(/^0-9a-zA-Z_\-\/:+/i,""),console.log("FETCHING:",t),a={},n=p.state.credentials[this.urlId],this.needsAuth&&(a["Authorization"]="Basic ".concat(n)),r=new Request(i,{headers:a}),e.next=8,fetch(r).then((function(e){if(200!=e.status)throw console.log("Status:",e.status),e;return e}));case 8:return s=e.sent,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileText",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.text());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileJson",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.json());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileBlob",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.blob());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDirectory",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,i.endsWith("/")||(i+="/"),e.next=4,this._getFileResponse(i).then();case 4:return a=e.sent,e.next=7,a.text();case 7:return n=e.sent,e.abrupt("return",this.buildListFromHtml(n));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildListFromHtml",value:function(e){return e.indexOf("SimpleWebServer")>-1?this.buildListFromSimpleWebServer(e):e.indexOf("<ul>")>-1?this.buildListFromSVN(e):e.indexOf("<table>")>-1?this.buildListFromApache24(e):{dirs:[],files:[]}}},{key:"buildListFromSimpleWebServer",value:function(e){var t,i=/">(.*?)<\/a/,a=[],n=[],r=e.split("\n"),s=Object(m["a"])(r);try{for(s.s();!(t=s.n()).done;){var o=t.value;console.log(o);var l=o.indexOf('<li><a href="');if(!(l<0)){var c=o.match(i);if(c){var u=c[1];u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u)}}}}catch(h){s.e(h)}finally{s.f()}return{dirs:a,files:n}}},{key:"buildListFromSVN",value:function(e){var t,i=/"(.*?)"/,a=[],n=[],r=e.split("\n"),s=Object(m["a"])(r);try{for(s.s();!(t=s.n()).done;){var o=t.value,l=o.indexOf('<li><a href="');if(!(l<0)){var c=o.match(i);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u))}}}}catch(h){s.e(h)}finally{s.f()}return{dirs:a,files:n}}},{key:"buildListFromApache24",value:function(e){var t,i=/"(.*?)"/,a=[],n=[],r=e.split("\n"),s=Object(m["a"])(r);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(!(o.indexOf('<th "')>-1)&&!(o.indexOf("[PARENTDIR]")>-1)){var l=o.indexOf('<td><a href="');if(!(l<0)){var c=o.substring(l).match(i);if(c){var u=c[1];"../"!==u&&(u.endsWith("/")?a.push(u.substring(0,u.length-1)):n.push(u))}}}}}catch(h){s.e(h)}finally{s.f()}return{dirs:a,files:n}}}]),e}(),zt=Dt,It=i("b8ae");O["c"].use(It["VuePlugin"]),be.a.insensitive=!0;var Nt=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Fahrzeuge:!1,Routen:!1,"DRT Anfragen":!1},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:l.line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:l.line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",carriers:"",projection:"",title:"",description:"",thumbnail:"",center:[13.4,52.5]},e.myState={statusMessage:"",clock:"00:00",colorScheme:a.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.searchTerm="",e.searchEnabled=!1,e.globalState=p.state,e.isDarkMode=e.myState.colorScheme===a.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.detailContent="",e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(y["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s,o,l,c,u,h,d,p,f,v,b,g,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=11;break}return this.selectedTour=null,this.detailContent="",e.abrupt("return");case 11:this.selectedTour=t,this.detailContent=JSON.stringify(t,null,4),i=[],a=[],n=0,r=Object(m["a"])(t.plan),e.prev=17,o=function(){var e=s.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),r="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===r)return"continue";var o=[k.links[r][0],k.links[r][1]],l=[k.links[r][2],k.links[r][3]],c=[.5*(k.links[r][0]+k.links[r][2]),.5*(k.links[r][1]+k.links[r][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,type:"pickup"===e.type?k.$t("pickup"):k.$t("delivery"),count:n++,link:r,midpoint:c,label:"",details:u,ptFrom:o,ptTo:l})}},r.s();case 20:if((s=r.n()).done){e.next=26;break}if(l=o(),"continue"!==l){e.next=24;break}return e.abrupt("continue",24);case 24:e.next=20;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](17),r.e(e.t0);case 31:return e.prev=31,r.f(),e.finish(31);case 34:for(c=0;c<a.length;c++){for(u="",h=0;h<c;h++)a[c].midpoint[0]===a[h].midpoint[0]&&a[c].midpoint[1]===a[h].midpoint[1]&&(u+=",".concat(h),",0"===u&&(u=",*"),a[c].label="");u+=",".concat(c),u=u.slice(1),"0"===u&&(u="*"),a[c].label=u}this.shipmentIdsInTour=i,d=ye()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),p=0,f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},v=t.routes.length>20?25:50,b=Object(m["a"])(t.routes),e.prev=41,b.s();case 43:if((g=b.n()).done){e.next=51;break}return y=g.value,this.addRouteToMap(t,y,a,d,p),p++,e.next=49,f(v);case 49:e.next=43;break;case 51:e.next=56;break;case 53:e.prev=53,e.t1=e["catch"](41),b.e(e.t1);case 56:return e.prev=56,b.f(),e.finish(56);case 59:this.stopMidpoints=a;case 60:case"end":return e.stop()}}),e,this,[[17,28,31,34],[41,53,56,59]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var r,s=[[this.links[t[0]][0],this.links[t[0]][1]]],o=Object(m["a"])(t);try{for(o.s();!(r=o.n()).done;){var l=r.value,c=[this.links[l][0],this.links[l][1]];c[0]===s[s.length-1][0]&&c[1]===s[s.length-1][1]||s.push(c),s.push([this.links[l][2],this.links[l][3]])}}catch(u){o.e(u)}finally{o.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:s,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,(null===(t=e.capabilities[0])||void 0===t||null===(i=t.vehicles[0])||void 0===i?void 0:i.vehicle)&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return be()(e,t)}))),this.shipments=this.processShipments(e),(null===(a=e.services[0])||void 0===a?void 0:a.service)&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return be()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(!(null===(t=e.plan[0])||void 0===t?void 0:t.tour))return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{vehicleId:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return be()(e.vehicleId,t.vehicleId)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];(null===(t=e.shipments[0])||void 0===t?void 0:t.shipment)&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return be()(e.id,t.id)})));try{var a,n=Object(m["a"])(i);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.fromX=.5*(this.links[r.from][0]+this.links[r.from][2]),r.fromY=.5*(this.links[r.from][1]+this.links[r.from][3]),r.toX=.5*(this.links[r.to][0]+this.links[r.to][2]),r.toY=.5*(this.links[r.to][1]+this.links[r.to][3])}}catch(s){n.e(s)}finally{n.f()}}catch(o){}return i}},{key:"handleSettingChange",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t];case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[13.4,52.5]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 12:i=this.vizDetails.title?this.vizDetails.title:"Carrier Explorer",this.$emit("title",i),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,fe.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===a.DarkMode,this.updateLegendColors()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.generateBreadcrumbs(),this.updateLegendColors(),this.myState.statusMessage="Loading carriers...",console.log("loading files"),e.next=13,this.loadCarriers();case 13:return this.carriers=e.sent,e.next=16,this.loadNetwork();case 16:this.links=e.sent,console.log("GO!"),this.myState.statusMessage="";case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCarriers",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFileOrGzippedFile(this.vizDetails.carriers);case 2:return t=e.sent,e.next=5,this.parseXML(t);case 5:return i=e.sent,a=i.carriers.carrier.sort((function(e,t){return be()(e.$.id,t.$.id)})),e.next=9,this.$nextTick();case 9:return console.log({carrierList:a}),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadNetwork",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="Loading network",!(this.vizDetails.network.indexOf(".xml.")>-1)){e.next=14;break}return e.next=4,this.loadFileOrGzippedFile(this.vizDetails.network);case 4:return t=e.sent,e.next=7,this.parseXML(t);case 7:return i=e.sent,e.next=10,this.convertRoadNetwork(i);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.next=16,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.network);case 16:if(n=e.sent,!n){e.next=23;break}return e.next=20,Object(xe["a"])(n);case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=null;case 24:return r=e.t0,e.next=27,je["run"](Oe.a.inflateAsync(r,{to:"string"}));case 27:return s=e.sent,o=JSON.parse(s),e.abrupt("return",o);case 30:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertRoadNetwork",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.statusMessage="Projecting network...",this.vizDetails.projection="EPSG:31464",e.next=4,dt.create({xml:t,projection:this.vizDetails.projection});case 4:return this._networkHelper=e.sent,this.myState.statusMessage="Crunching road network...",e.next=8,this._networkHelper.createNodesAndLinks();case 8:return this.myState.statusMessage="Converting coordinates...",e.next=11,this._networkHelper.convertCoordinates();case 11:for(i=e.sent,this._networkHelper.destroy(),this.myState.statusMessage="Merging links and nodes",a=i.network.nodes,n={},r=0,s=Object.keys(i.network.links);r<s.length;r++)o=s[r],l=i.network.links[o],n[o]=[a[l.from].x,a[l.from].y,a[l.to].x,a[l.to].y];return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this.myState.isRunning=!1,this._networkHelper&&this._networkHelper.destroy(),p.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"parseXML",value:function(e){var t=new Se.a.Parser({strict:!0,trim:!0,preserveChildrenOrder:!0,explicitChildren:!0,explicitArray:!0});return new Promise((function(i,a){t.parseString(e,(function(e,t){e?a(e):i(t)}))}))}},{key:"loadFileOrGzippedFile",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("loading",t),i="",e.prev=2,!t.endsWith("xml")){e.next=9;break}return e.next=6,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+t);case 6:i=e.sent,e.next=24;break;case 9:if(!t.endsWith("gz")){e.next=24;break}return e.next=12,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+t);case 12:if(a=e.sent,!a){e.next=19;break}return e.next=16,Object(xe["a"])(a);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:return n=e.t0,e.next=23,je["run"](Oe.a.inflateAsync(n,{to:"string"}));case 23:i=e.sent;case 24:e.next=31;break;case 26:e.prev=26,e.t1=e["catch"](2),r=t+": "+e.t1,console.error(e.t1),this.myState.statusMessage=r;case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,this,[[2,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===a.DarkMode?a.LightMode:a.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===a.DarkMode?t:e}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Nt.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nt.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nt.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nt.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Nt.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("globalState.colorScheme")],Nt.prototype,"swapTheme",null),Nt=Object(w["a"])([Object(O["a"])({components:{CollapsiblePanel:Fe,DetailsPanel:rt,LegendColors:ze,PlaybackControls:Ue,SettingsPanel:Ke,ToggleButton:pe["ToggleButton"],TourViz:Pt,VueSlider:de.a}})],Nt),p.commit("registerPlugin",{kebabName:"carrier-viewer",prettyName:"Carrier Viewer",description:"For freight etc!",filePatterns:["viz-carrier*.y?(a)ml"],component:Nt});var Bt=Nt,Ht=Bt,Vt=(i("5176"),i("d388")),$t=Object(_["a"])(Ht,ce,ue,!1,null,"501bbd00",null);"function"===typeof Vt["default"]&&Object(Vt["default"])($t);var qt=$t.exports,Ut=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app",oncontextmenu:"return false"}},[e.thumbnail?e._e():i("div",{staticClass:"nav"},[i("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():i("trip-viz",{staticClass:"anim",attrs:{simulationTime:e.simulationTime,paths:e.$options.paths,drtRequests:e.$options.drtRequests,traces:e.$options.traces,colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"150",direction:"right"}},[i("div",{staticClass:"big clock"},[i("p",[e._v(e._s(e.myState.clock))])]),i("div",{staticClass:"panel-items"},[i("legend-colors",{staticClass:"legend-block",attrs:{title:"Anfragen:",items:e.legendRequests}}),e.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{title:"Passagiere:",items:e.legendItems}}):e._e(),i("div",{staticClass:"search-panel"},[i("p",{staticClass:"speed-label",style:{margin:"1rem 0 0 0",color:e.textColor.text}},[e._v("Suche:")]),i("form",{attrs:{autocomplete:"off"}}),i("div",{staticClass:"field"},[i("p",{staticClass:"control has-icons-left"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],staticClass:"input is-small",attrs:{type:"email",placeholder:"Search..."},domProps:{value:e.searchTerm},on:{input:function(t){t.target.composing||(e.searchTerm=t.target.value)}}}),i("span",{staticClass:"icon is-small is-left"},[i("i",{staticClass:"fas fa-search"})])])])]),i("settings-panel",{staticClass:"settings-area",attrs:{items:e.SETTINGS},on:{click:e.handleSettingChange}}),i("div",{staticClass:"speed-block"},[i("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v("Geschwindigkeit:"),i("br"),e._v(e._s(e.speed)+"x")]),i("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}})],1)],1)])],1):e._e(),i("div",{staticClass:"bottom-area"},[!e.thumbnail&&e.isLoaded?i("playback-controls",{staticClass:"playback-stuff",attrs:{timeStart:e.timeStart,timeEnd:e.timeEnd,isRunning:e.myState.isRunning,currentTime:e.simulationTime},on:{click:e.toggleSimulation,time:e.setTime}}):e._e()],1)],1)},Yt=[],Gt=(i("4160"),i("159b"),i("2909")),Xt=i("7783"),Wt={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Jt=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"getShaders",value:function(){var e=Object(xt["a"])(Object(jt["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(xt["a"])(Object(jt["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props.currentTime;e.uniforms=Object.assign({},e.uniforms,{currentTime:t}),Object(xt["a"])(Object(jt["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(wt["a"]);Jt.layerName="DrtRequestArcLayer",Jt.defaultProps=Wt;i("a9e3"),i("aff5"),i("cfc3");var Zt,Kt=i("2b88"),Qt=i("050f"),ei=i("2bb8"),ti=i("01a6"),ii=i("ca47"),ai=i("d22f"),ni=(i("90d7"),i("07ac"),i("ade3")),ri=i("31d5"),si=i("a7bc"),oi=i("7f94"),li=i("9c99"),ci=i("2418"),ui=i("ae9c"),hi=i("261f"),di=1024,pi=4,mi=function(){},fi=(Zt={},Object(ni["a"])(Zt,ti["a"].TEXTURE_MIN_FILTER,ti["a"].LINEAR_MIPMAP_LINEAR),Object(ni["a"])(Zt,ti["a"].TEXTURE_MAG_FILTER,ti["a"].LINEAR),Object(ni["a"])(Zt,ti["a"].TEXTURE_WRAP_S,ti["a"].CLAMP_TO_EDGE),Object(ni["a"])(Zt,ti["a"].TEXTURE_WRAP_T,ti["a"].CLAMP_TO_EDGE),Zt);function vi(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function bi(e,t,i,a){return i===t.width&&a===t.height?t:(e.canvas.height=a,e.canvas.width=i,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,i,a),e.canvas)}function gi(e){return e&&(e.id||e.url)}function yi(e,t,i,a){var n=t.width,r=t.height,s=Object(ri["a"])(t,{width:i,height:a});return Object(si["b"])(t,s,{targetX:0,targetY:0,targetZ:0,width:n,height:r}),t.delete(),s}function ki(e,t,i){for(var a=0;a<t.length;a++){var n=t[a],r=n.icon,s=n.xOffset,o=gi(r);e[o]=Object.assign({},r,{x:s,y:i})}}function Si(e){for(var t=e.icons,i=e.buffer,a=e.mapping,n=void 0===a?{}:a,r=e.xOffset,s=void 0===r?0:r,o=e.yOffset,l=void 0===o?0:o,c=e.rowHeight,u=void 0===c?0:c,h=e.canvasWidth,d=[],p=0;p<t.length;p++){var m=t[p],f=gi(m);if(!n[f]){var v=m.height,b=m.width;s+b+i>h&&(ki(n,d,l),s=0,l=u+l+i,u=0,d=[]),d.push({icon:m,xOffset:s}),s=s+b+i,u=Math.max(u,v)}}return d.length>0&&ki(n,d,l),{mapping:n,rowHeight:u,xOffset:s,yOffset:l,canvasWidth:h,canvasHeight:vi(u+l+i)}}function wi(e,t,i){if(!e||!t)return null;i=i||{};var a,n={},r=Object(ui["a"])(e),s=r.iterable,o=r.objectInfo,l=Object(m["a"])(s);try{for(l.s();!(a=l.n()).done;){var c=a.value;o.index++;var u=t(c,o),h=gi(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");n[h]||i[h]&&u.url===i[h].url||(n[h]=u)}}catch(d){l.e(d)}finally{l.f()}return n}var Oi=function(){function e(t,i){var a=i.onUpdate,n=void 0===a?mi:a;Object(g["a"])(this,e),this.gl=t,this.onUpdate=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=pi,this._canvasWidth=di,this._canvasHeight=0,this._canvas=null}return Object(y["a"])(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?gi(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.loadOptions,i=e.autoPacking,a=e.iconAtlas,n=e.iconMapping,r=e.data,s=e.getIcon;t&&(this._loadOptions=t),void 0!==i&&(this._autoPacking=i),s&&(this._getIcon=s),n&&(this._mapping=n),a&&this._updateIconAtlas(a),this._autoPacking&&(r||s)&&"undefined"!==typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}},{key:"_updateIconAtlas",value:function(e){this._texture&&(this._texture.delete(),this._texture=null),e instanceof oi["a"]?(e.setParameters(fi),this._externalTexture=e,this.onUpdate()):e&&(this._texture=new oi["a"](this.gl,{data:e,parameters:fi}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(e){var t=Object.values(wi(e,this._getIcon,this._mapping)||{});if(t.length>0){var i=Si({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=i.mapping,n=i.xOffset,r=i.yOffset,s=i.rowHeight,o=i.canvasHeight;this._rowHeight=s,this._mapping=a,this._xOffset=n,this._yOffset=r,this._canvasHeight=o,this._texture||(this._texture=new oi["a"](this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:fi})),this._texture.height!==this._canvasHeight&&(this._texture=yi(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}},{key:"_loadIcons",value:function(e){var t,i=this,a=this._canvas.getContext("2d"),n=Object(m["a"])(e);try{var r=function(){var e=t.value;i._pendingCount++,Object(ci["a"])(e.url,li["a"],i._loadOptions).then((function(t){var n=gi(e),r=i._mapping[n],s=r.x,o=r.y,l=r.width,c=r.height,u=bi(a,t,l,c);i._texture.setSubImageData({data:u,x:s,y:o,width:l,height:c}),i._texture.generateMipmap(),i.onUpdate()})).catch((function(e){hi["a"].error(e)()})).finally((function(){i._pendingCount--}))};for(n.s();!(t=n.n()).done;)r()}catch(s){n.e(s)}finally{n.f()}}},{key:"isLoaded",get:function(){return 0===this._pendingCount}}]),e}(),xi=i("f863").default,ji=i("0554").default,Ci=[0,0,0,255],Ti={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},noAlloc:!0,iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:Ci},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0}},_i=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"getShaders",value:function(){return Object(xt["a"])(Object(jt["a"])(i.prototype),"getShaders",this).call(this,{vs:xi,fs:ji,modules:[Kt["a"],Qt["a"]]})}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new Oi(this.context.gl,{onUpdate:function(){return e._onUpdate()}})};var t=this.getAttributeManager();t.addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColors:{size:this.props.colorFormat.length,type:ti["a"].UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Ci},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){var t=e.oldProps,a=e.props,n=e.changeFlags;Object(xt["a"])(Object(jt["a"])(i.prototype),"updateState",this).call(this,{props:a,oldProps:t,changeFlags:n});var r=this.getAttributeManager(),s=a.iconAtlas,o=a.iconMapping,l=a.data,c=a.getIcon,u=this.state.iconManager;u.setProps({loadOptions:a.loadOptions});var h=!1,d=s||this.internalState.isAsyncPropLoading("iconAtlas");if(d?(t.iconAtlas!==a.iconAtlas&&u.setProps({iconAtlas:s,autoPacking:!1}),t.iconMapping!==a.iconMapping&&(u.setProps({iconMapping:o}),h=!0)):u.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&(u.setProps({data:l,getIcon:c}),h=!0),h&&(r.invalidate("instanceOffsets"),r.invalidate("instanceIconFrames")),n.extensionsChanged){var p=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(p)}),r.invalidateAll()}}},{key:"finalizeState",value:function(){Object(xt["a"])(Object(jt["a"])(i.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,i=this.props,a=i.sizeScale,n=i.sizeMinPixels,r=i.sizeMaxPixels,s=i.sizeUnits,o=i.billboard,l=i.alphaCutoff,c=i.currentTime,u=i.iconStill,h=i.pickable,d=this.state.iconManager,p=this.context.viewport,m=d.getTexture();m&&m.loaded&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:m,iconsTextureDim:[m.width,m.height],sizeScale:a*("pixels"===s?p.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:r,billboard:o,alphaCutoff:l,currentTime:c,pickable:h,iconStillOffsets:this.getInstanceOffset(u),iconStillFrames:this.getInstanceIconFrame(u)})).draw()}},{key:"_getModel",value:function(e){var t=[-1,-1,-1,1,1,1,1,-1];return new ii["a"](e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new ai["a"]({drawMode:ti["a"].TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}},{key:"isLoaded",get:function(){return Object(xt["a"])(Object(jt["a"])(i.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}}]),i}(ei["a"]);_i.layerName="MovingIconLayer",_i.defaultProps=Ti;var Ri=i("125d"),Ei={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Ai=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"getShaders",value:function(){var e=Object(xt["a"])(Object(jt["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if(timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        varying float vTime;\n        uniform float searchFlag;\n      ","fs:#main-start":"        if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (searchFlag == 0.0 && vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(xt["a"])(Object(jt["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props,a=t.currentTime,n=t.searchFlag;e.uniforms=Object.assign({},e.uniforms,{currentTime:a,searchFlag:n}),Object(xt["a"])(Object(jt["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(Ri["a"]);Ai.layerName="PathTraceLayer",Ai.defaultProps=Ei;var Li={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!1},diamond:{x:0,y:128,width:128,height:128,mask:!1}},Mi="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Fi=new ft["a"]({color:[255,255,255],intensity:1}),Pi=new vt["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),Di=new bt["a"]({ambientLight:Fi,pointLight:Pi}),zi={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[Di]},Ii={latitude:52.1,longitude:14,zoom:10,pitch:0,minZoom:2,maxZoom:22},Ni={time:0,fromX:1,fromY:2,toX:3,toY:4,veh:5,arrival:6};function Bi(e){var t="mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex",i=e.simulationTime,a=e.paths,n=e.traces,r=e.drtRequests,s=e.settingsShowLayers,o=e.center,l=e.vehicleLookup,c=e.searchEnabled,u=e.onClick,h=zi,d=Object.assign({},Ii);d.latitude=o[1],d.longitude=o[0];var p=1,m=Object(Pe["useState"])({}),f=Object(pt["a"])(m,2),v=f[0],b=f[1],g=[];function y(){console.log(v),v.object?u(v.object.v):u(null)}function k(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;var r=l[i.v];return De.a.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:a+40,top:n-30}},De.a.createElement("big",null,De.a.createElement("b",null,"Taxi: ",r)),De.a.createElement("div",null,"Passagiere: ",i.occ," "))}return s["Routen"]&&g.push(new Ai({id:"Routen",data:n,currentTime:i,getSourcePosition:function(e){return e.p0},getTargetPosition:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getColor:function(t){return e.colors[t.occ]},getWidth:function(e){return 3*(e.occ+1)-1},opacity:.9,widthMinPixels:2,rounded:!1,shadowEnabled:!1,searchFlag:c?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:b})),s["Fahrzeuge"]&&g.push(new _i({id:"Vehicles",data:a,getPathStart:function(e){return e.p0},getPathEnd:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getIcon:function(e){return"vehicle"},getColor:function(t){return e.colors[t.occ]},iconMoving:"vehicle",iconStill:"diamond",getSize:c?56:44,opacity:1,currentTime:i,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/icon-atlas.png",iconMapping:Li,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:b})),s["DRT Anfragen"]&&g.push(new Jt({id:"DRT Requests",data:r,currentTime:i,getSourcePosition:function(e){return[e[Ni.fromX],e[Ni.fromY]]},getTargetPosition:function(e){return[e[Ni.toX],e[Ni.toY]]},getTimeStart:function(e){return e[Ni.time]},getTimeEnd:function(e){return e[Ni.arrival]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:p,opacity:.5,searchFlag:c?1:0})),De.a.createElement(gt["a"],{layers:g,effects:h.effects,pickingRadius:5,initialViewState:d,controller:!0,getCursor:function(){return"pointer"},onClick:y},De.a.createElement(mt["b"],{reuseMaps:!0,mapStyle:t,preventStyleDiffing:!0,mapboxApiAccessToken:Mi}),k({hoverInfo:v}))}O["c"].use(It["VuePlugin"]);var Hi=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Fahrzeuge:!0,Routen:!1,"DRT Anfragen":!1},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:l.line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:l.line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[6.5,51]},e.myState={statusMessage:"",clock:"00:00",colorScheme:a.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.timeStart=0,e.timeEnd=86400,e.traces=Object(Xt["a"])([]),e.paths=Object(Xt["a"])([]),e.requests=Object(Xt["a"])([]),e.simulationTime=21600,e.timeElapsedSinceLastFrame=0,e.searchTerm="",e.searchEnabled=!1,e.globalState=p.state,e.isDarkMode=e.myState.colorScheme===a.DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e.isPausedDueToHiding=!1,e}return Object(y["a"])(i,[{key:"handleSettingChange",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t],this.updateDatasetFilters(),this.simulationTime+=1;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[14,52.1]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 12:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,fe.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===a.DarkMode,this.updateLegendColors()}},{key:"handleSearch",value:function(){var e,t,i,a,n,r,s=this.vehicleLookupString[this.searchTerm];s>-1?(console.log("vehicle",s),null===(e=this.pathVehicle)||void 0===e||e.filterExact(s),null===(t=this.traceVehicle)||void 0===t||t.filterExact(s),null===(i=this.requestVehicle)||void 0===i||i.filterExact(s),this.requestStart.filterAll(),this.requestEnd.filterAll(),this.searchEnabled=!0):(console.log("nope"),null===(a=this.pathVehicle)||void 0===a||a.filterAll(),null===(n=this.traceVehicle)||void 0===n||n.filterAll(),null===(r=this.requestVehicle)||void 0===r||r.filterAll(),this.searchEnabled=!1);this.updateDatasetFilters()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"setWallClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock="".concat(e<10?"0":"").concat(e).concat(t<10?":0":":").concat(t)}},{key:"setTime",value:function(e){this.simulationTime=e,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered()}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.generateBreadcrumbs(),this.updateLegendColors(),this.setWallClock(),this.myState.statusMessage="/ Dateien laden...",console.log("loading files"),e.next=14,this.loadFiles();case 14:return t=e.sent,i=t.trips,a=t.drtRequests,console.log("parsing vehicle motion"),this.myState.statusMessage="/ Standorte berechnen...",e.next=21,this.parseVehicles(i);case 21:return this.paths=e.sent,this.pathStart=this.paths.dimension((function(e){return e.t0})),this.pathEnd=this.paths.dimension((function(e){return e.t1})),this.pathVehicle=this.paths.dimension((function(e){return e.v})),console.log("Routen verarbeiten..."),this.myState.statusMessage="/ Routen verarbeiten...",e.next=29,this.parseRouteTraces(i);case 29:return this.traces=e.sent,this.traceStart=this.traces.dimension((function(e){return e.t0})),this.traceEnd=this.traces.dimension((function(e){return e.t1})),this.traceVehicle=this.traces.dimension((function(e){return e.v})),console.log("Anfragen sortieren..."),this.myState.statusMessage="/ Anfragen...",e.next=37,this.parseDrtRequests(a);case 37:this.requests=e.sent,this.requestStart=this.requests.dimension((function(e){return e[0]})),this.requestEnd=this.requests.dimension((function(e){return e[6]})),this.requestVehicle=this.requests.dimension((function(e){return e[5]})),console.log("GO!"),this.myState.statusMessage="",document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate();case 47:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseDrtRequests",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.vehicleLookup.length){i=Object(m["a"])(t);try{for(i.s();!(a=i.n()).done;){n=a.value;try{n[5]=this.vehicleLookupString[n[5]]}catch(r){}}}catch(s){i.e(s)}finally{i.f()}}return e.abrupt("return",Object(Xt["a"])(t));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"parseVehicles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=[],a=-1,e.next=4,je["forEachAsync"](t,(function(e){var t=e.path,r=e.timestamps,s=e.passengers;a++,n.vehicleLookup[a]=e.id,n.vehicleLookupString[e.id]=a;for(var o=0;o<e.path.length-1;o++)i.push({t0:r[o],t1:r[o+1],p0:t[o],p1:t[o+1],v:a,occ:s[o]})}));case 4:return e.abrupt("return",Object(Xt["a"])(i));case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateDatasetFilters",value:function(){this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.Routen&&(this.searchEnabled?(this.traceStart.filterAll(),this.traceEnd.filterAll()):(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.Fahrzeuge&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS["DRT Anfragen"]&&(this.searchEnabled?(this.requestStart.filterAll(),this.requestEnd.filterAll()):(this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()))}},{key:"animate",value:function(){if(this.myState.isRunning){var e=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=e,this.simulationTime+=e*this.speed*.06,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}}},{key:"handleVisibilityChange",value:function(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())}},{key:"parseRouteTraces",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return 0,i=-1,a=[],e.next=5,je["forEachAsync"](t,(function(e){i++;for(var t=e.timestamps[0],n=e.timestamps[0],r=[],s=function(s){n=e.timestamps[s],e.path[s][0]===e.path[s-1][0]&&e.path[s][1]===e.path[s-1][1]?(r.forEach((function(t){t.t1=e.timestamps[s-1]})),a.push.apply(a,Object(Gt["a"])(r)),r=[],t=n):r.push({t0:t,p0:e.path[s-1],p1:e.path[s],v:i,occ:e.passengers[s-1]})},o=1;o<e.path.length;o++)s(o);r.forEach((function(e){e.t1=n})),a.push.apply(a,Object(Gt["a"])(r))}));case 5:return e.abrupt("return",Object(Xt["a"])(a));case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),p.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],i=[],e.prev=2,!this.vizDetails.drtTrips.endsWith("json")){e.next=11;break}return e.next=6,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 6:a=e.sent,t=a.trips,i=a.drtRequests,e.next=29;break;case 11:if(!this.vizDetails.drtTrips.endsWith("gz")){e.next=29;break}return e.next=14,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.drtTrips);case 14:if(n=e.sent,!n){e.next=21;break}return e.next=18,Object(xe["a"])(n);case 18:e.t0=e.sent,e.next=22;break;case 21:e.t0=null;case 22:return r=e.t0,e.next=25,je["run"](Oe.a.inflateAsync(r,{to:"string"}));case 25:s=e.sent,o=JSON.parse(s),t=o.trips,i=o.drtRequests;case 29:e.next=35;break;case 31:e.prev=31,e.t1=e["catch"](2),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 35:return e.abrupt("return",{trips:t,drtRequests:i});case 36:case"end":return e.stop()}}),e,this,[[2,31]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===a.DarkMode?a.LightMode:a.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===a.DarkMode?t:e}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Hi.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Hi.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Hi.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Hi.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Hi.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("state.colorScheme")],Hi.prototype,"swapTheme",null),Object(w["a"])([Object(O["d"])("searchTerm")],Hi.prototype,"handleSearch",null),Hi=Object(w["a"])([Object(O["a"])({components:{CollapsiblePanel:Fe,SettingsPanel:Ke,LegendColors:ze,TripViz:Bi,VueSlider:de.a,PlaybackControls:Ue,ToggleButton:pe["ToggleButton"]}})],Hi),p.commit("registerPlugin",{kebabName:"vehicle-animation",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["viz-vehicles*.y?(a)ml"],component:Hi});var Vi=Hi,$i=Vi,qi=(i("d9d0"),Object(_["a"])($i,Ut,Yt,!1,null,"6e0039fc",null)),Ui=qi.exports,Yi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?i("xy-hex-layer",{staticClass:"anim",attrs:{center:e.center,data:e.requests,extrude:e.extrudeTowers,radius:e.radius,maxHeight:e.maxHeight}}):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"250",direction:"left"}},[i("div",{staticClass:"panel-items"},[i("p",{staticClass:"big xtitle"},[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])])])],1):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{darkMode:!0,width:"150",direction:"right"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Aggregate")]),i("div",{staticClass:"buttons has-addons"},e._l(Object.keys(e.aggregations),(function(t){return i("button",{key:t,staticClass:"button is-small is-dark",class:{"is-danger":e.activeAggregation===t},on:{click:function(i){return e.handleOrigDest(t)}}},[e._v(e._s(t))])})),0)]),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Show in 3D")]),i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.extrudeTowers,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.extrudeTowers=!e.extrudeTowers}}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Max Height: "+e._s(e.maxHeight))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:100,max:1e3,interval:50,duration:0,dotSize:16,tooltip:"none"},model:{value:e.maxHeight,callback:function(t){e.maxHeight=t},expression:"maxHeight"}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Radius: "+e._s(e.radius))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:16,tooltip:"none"},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}})],1)])])],1):e._e(),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},Gi=[],Xi=(i("f00c"),i("b680"),i("4ce1")),Wi="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Ji=new ft["a"]({color:[255,255,255],intensity:1}),Zi=new vt["a"]({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),Ki=new vt["a"]({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),Qi=new bt["a"]({ambientLight:Ji,pointLight1:Zi,pointLight2:Ki}),ea={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},ta={zoom:10,minZoom:5,maxZoom:15,pitch:30,bearing:0},ia=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]];function aa(e){var t=e.object;if(!t||!t.position||!t.position.length)return null;var i=t.position[1],a=t.position[0],n=t.points.length;return{text:"    ".concat(n," Pickups\n    latitude: ").concat(Number.isFinite(i)?i.toFixed(6):"","\n    longitude: ").concat(Number.isFinite(a)?a.toFixed(6):"","\n    ")}}function na(e){var t=e.data,i=void 0===t?[]:t,a=e.mapStyle,n=void 0===a?"mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex":a,r=e.radius,s=void 0===r?100:r,o=e.upperPercentile,l=void 0===o?100:o,c=e.coverage,u=void 0===c?.8:c,h=e.extrude,d=void 0===h||h,p=e.maxHeight,m=void 0===p?200:p,f=e.center,v=void 0===f?[14.34,52.3]:f,b=Object(pt["a"])(v,2),g=b[0],y=b[1],k=Object.assign(ta,{longitude:g,latitude:y}),S=[new Xi["a"]({id:"hexlayer",colorRange:ia,coverage:u,data:i,autoHighlight:!0,elevationRange:[0,m],elevationScale:i&&i.length?50:0,extruded:d,getPosition:function(e){return e},pickable:!0,radius:s,upperPercentile:l,material:ea,transitions:{elevationScale:{type:"interpolation",duration:1e3}}})];return De.a.createElement(gt["a"],{layers:S,effects:[Qi],initialViewState:k,controller:!0,getTooltip:aa},De.a.createElement(mt["a"],{reuseMaps:!0,mapStyle:n,preventStyleDiffing:!0,mapboxApiAccessToken:Wi}))}O["c"].use(It["VuePlugin"]);var ra=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.radius=250,e.maxHeight=200,e.extrudeTowers=!1,e.vizDetails={title:"",description:"",file:"",projection:"",thumbnail:"",data:{}},e.myState={statusMessage:"",colorScheme:a.DarkMode,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.requests=[],e.searchTerm="",e.searchEnabled=!1,e.globalState=p.state,e.isDarkMode=e.myState.colorScheme===a.DarkMode,e.isLoaded=!1,e.activeAggregation="",e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.center=[0,0],e.rawRequests=[],e.aggregations={},e}return Object(y["a"])(i,[{key:"handleOrigDest",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.activeAggregation=t,i=this.aggregations[t],this.requests=this.rawRequests.map((function(e){return[e[i[0]],e[i[1]]]}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.fileSystem)return[];var e,t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(a+=r+"/",t.push({label:r,url:"/"+this.myState.fileSystem.url+a}))}}catch(s){n.e(s)}finally{n.f()}return t.push({label:this.vizDetails.title,url:"#"}),p.commit("setBreadCrumbs",t),t}},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 11:i=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation",this.$emit("title",i);case 13:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,fe.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===a.DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"findCenter",value:function(e){var t="";for(t in this.aggregations)break;for(var i=this.aggregations[t][0],a=this.aggregations[t][1],n=0,r=0,s=0,o=0;o<e.length;o+=64)s++,n+=e[o][i],r+=e[o][a];return n/=s,r/=s,[n,r]}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.generateBreadcrumbs(),this.myState.statusMessage="Dateien laden...",console.log("loading files"),e.next=11,this.loadFiles();case 11:t=e.sent,i=t.dataArray,this.rawRequests=i,this.aggregations=this.parseAggregations(),this.center=this.findCenter(this.rawRequests),this.isLoaded=!0,this.buildThumbnail(),console.log("DRT Anfragen sortieren..."),this.myState.statusMessage="DRT Anfragen sortieren...",this.handleOrigDest(Object.keys(this.aggregations)[0]),this.myState.statusMessage="";case 22:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseAggregations",value:function(){var e,t={},i=Object(m["a"])(this.vizDetails.data.aggregations);try{for(i.s();!(e=i.n()).done;){var a=e.value;t[a.title]=[a.x,a.y]}}catch(n){i.e(n)}finally{i.f()}return t}},{key:"beforeDestroy",value:function(){p.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!this.vizDetails.file.endsWith("json")){e.next=9;break}return e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.file);case 5:i=e.sent,t=i[this.vizDetails.data.elements],e.next=26;break;case 9:if(!this.vizDetails.file.endsWith("gz")){e.next=26;break}return e.next=12,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.file);case 12:if(a=e.sent,!a){e.next=19;break}return e.next=16,Object(xe["a"])(a);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:return n=e.t0,e.next=23,je["run"](Oe.a.inflateAsync(n,{to:"string"}));case 23:r=e.sent,s=JSON.parse(r),t=s[this.vizDetails.data.elements];case 26:e.next=32;break;case 28:e.prev=28,e.t1=e["catch"](1),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 32:return e.abrupt("return",{dataArray:t});case 33:case"end":return e.stop()}}),e,this,[[1,28]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===a.DarkMode?a.LightMode:a.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===a.DarkMode?t:e}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],ra.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ra.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ra.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ra.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],ra.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("state.colorScheme")],ra.prototype,"swapTheme",null),ra=Object(w["a"])([Object(O["a"])({components:{CollapsiblePanel:Fe,XyHexLayer:na,VueSlider:de.a,ToggleButton:pe["ToggleButton"]}})],ra),p.commit("registerPlugin",{kebabName:"xy-hexagons",prettyName:"XY Aggregator",description:"Collects XY data into geographic hexagons",filePatterns:["viz-xy*.y?(a)ml"],component:ra});var sa=ra,oa=sa,la=(i("8d41"),Object(_["a"])(oa,Yi,Gi,!1,null,"6405abc1",null)),ca=la.exports,ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app"}},[!e.thumbnail&&e.vizDetails.network?a("animation-view",{staticClass:"anim",attrs:{vizState:e.myState,speed:e.speed,fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,vizDetails:e.vizDetails},on:{loaded:e.toggleLoaded}}):e._e(),e.thumbnail?e._e():a("modal-markdown-dialog",{class:{"is-active":e.showHelp},attrs:{id:"help-dialog",title:"DRT Vehicles",md:"@/assets/animation-helptext.md",buttons:["OK"]},on:{click:function(t){return e.clickedCloseHelp()}}}),e.thumbnail?e._e():a("div",{staticClass:"nav"},[a("p",{staticClass:"big day"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?a("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):a("p",{staticClass:"big time"},[e._v(e._s(e.myState.clock))])]),a("div",{staticClass:"right-side"},[e.isLoaded?a("div",{staticClass:"morestuff"},[a("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}}),a("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v(e._s(e.speed)+"x speed")])],1):e._e()]),e.isLoaded?a("playback-controls",{staticClass:"playback-stuff",on:{click:e.toggleSimulation}}):e._e(),e.isLoaded?a("div",{staticClass:"extra-buttons"},[a("div",{staticClass:"help-button",attrs:{title:"info"},on:{click:e.clickedHelp}},[a("i",{staticClass:"help-button-text fa fa-1x fa-question"})]),a("img",{staticClass:"theme-button",attrs:{src:i("0386"),title:"dark/light theme"},on:{click:e.rotateColors}})]):e._e()],1)},ha=[],da=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"anim-container"}})},pa=[],ma=i("9037"),fa=i("5a89"),va=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(e,a,n){var r;Object(g["a"])(this,i),r=t.call(this),r.tripsPerAgent={},r.midX=a,r.midY=n;for(var s=[],o=[],l=0,c=Object.keys(e);l<c.length;l++){var u=c[l],h=e[u];r.buildWaypoints(h,s,o)}return r.setAttribute("position",new fa["f"](s,3)),r.setAttribute("position2",new fa["f"](o,3)),r}return Object(y["a"])(i,[{key:"buildWaypoints",value:function(e,t,i){var a=e.time.length;if(!(a<2)){var n=0;if(0!==e.time[0]){var r=e.path[0][0]-this.midX,s=e.path[0][1]-this.midY,o=e.time[0];t.push(r,s,0),i.push(r,s,o),n++}for(var l=0;l<a-1;l++){var c=e.path[l][0]-this.midX,u=e.path[l][1]-this.midY,h=e.time[l];t.push(c,u,h);var d=e.path[l+1][0]-this.midX,p=e.path[l+1][1]-this.midY,m=e.time[l+1];i.push(d,p,m),n++}this.tripsPerAgent[e.id]=n}}}]),i}(fa["b"]),ba=va,ga=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.call(this),e.SIMULATION_PERCENT="sim-percent",e.DRAG="sim-drag",e}return i}(O["c"]);ga=Object(w["a"])([O["a"]],ga);var ya,ka,Sa,wa=new ga,Oa=wa,xa=Object(_["a"])(Oa,ya,ka,!1,null,null,null),ja=xa.exports,Ca=i("c162"),Ta=i.n(Ca);(function(e){e["FetchXML"]="FetchXML"})(Sa||(Sa={}));var _a=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.call(this,new Ta.a)}return Object(y["a"])(i,[{key:"fetchXML",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Sa.FetchXML,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(st,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ct),Ra=function(e){Object(k["a"])(n,e);var t=Object(S["a"])(n);function n(){var e;return Object(g["a"])(this,n),e=t.apply(this,arguments),e.timeFactor=600,e.myState=e.vizState,e.timeDirection=1,e.vertexShader=i("e9b2").default,e.fragmentShader=i("a278").default,e.globalState=p.state,e.colors=e.myState.colorScheme==a.DarkMode?u:c,e.simulationTime=0,e.animationTimeSinceUnpaused=0,e.clock=new fa["c"](!1),e.nextClockUpdateTime=0,e.scene=new fa["p"],e.renderer=new fa["y"]({antialias:!0}),e.network={nodes:{},links:{}},e.OrbitControl=i("d1f5"),e.linkMaterial=new fa["i"]({color:e.colors.links}),e.xRange=[1e25,-1e25],e.yRange=[1e25,-1e25],e.midpointX=36e4,e.midpointY=5715e3,e.tripList={},e.wasSimulationRunning=!0,e.networkLayers=[],e.tempStreamBuffer="",e}return Object(y["a"])(n,[{key:"speedChanged",value:function(){this.myState.isRunning=!0;var e=this.speed<0?-1:1;e!==this.timeDirection&&(this.clock.stop(),this.clock=new fa["c"](!1),this.timeDirection=e,this.clock.start(),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused),console.log("done flip"))}},{key:"playPauseSim",value:function(){this.myState.isRunning?(this.clock.start(),requestAnimationFrame(this.animate)):(this.clock.stop(),this.clock=new fa["c"](!1),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused))}},{key:"switchColorScheme",value:function(e){this.colors=e==a.LightMode?c:u,this.scene.background=new fa["d"](this.colors.background);var t=this.scene.getObjectByName("network");t&&this.scene.remove(t),this.linkMaterial.dispose(),this.linkMaterial=new fa["i"]({color:this.colors.links});var i,n=Object(m["a"])(this.networkLayers);try{for(n.s();!(i=n.n()).done;){var r=i.value,s=r.name,o=this.scene.getObjectByName(s);o&&this.scene.remove(o);var l=new fa["j"](r.geometry,this.linkMaterial);l.name=s,this.scene.add(l)}}catch(h){n.e(h)}finally{n.f()}}},{key:"mounted",value:function(){this.setInitialClockTime(),this.setupSimulation(),this.setupDragListener(),window.addEventListener("resize",this.onWindowResize,!1),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)}},{key:"setInitialClockTime",value:function(){var e=""+this.$route.query.start;if(e&&NaN!=parseInt(e)){var t=parseInt(e);t>=0&&(this.simulationTime=t,this.setVisibleClock(),this.$nextTick())}}},{key:"handleVisibilityChange",value:function(){console.log("window visibility changed!! hidden:",document.hidden)}},{key:"setupDragListener",value:function(){var e=this;ja.$on(ja.DRAG,(function(t){-1===t?(e.wasSimulationRunning=e.myState.isRunning,e.myState.isRunning=!1):-2===t?e.myState.isRunning=e.wasSimulationRunning:(e.simulationTime=e.nextClockUpdateTime=t,e.animate())}))}},{key:"exitSimulation",value:function(){this.clock=new fa["c"](!1),this.simulationTime=0,this.nextClockUpdateTime=0,this.timeDirection=1;while(this.scene.children.length)this.scene.remove(this.scene.children[0])}},{key:"beforeDestroy",value:function(){this.exitSimulation(),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("visibilityChange",this.handleVisibilityChange),ja.$off(ja.DRAG),this.agentMaterial&&this.agentMaterial.dispose(),this.agentGeometry&&this.agentGeometry.dispose();var e,t=Object(m["a"])(this.networkLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.geometry.dispose()}}catch(a){t.e(a)}finally{t.f()}this.linkMaterial.dispose(),this.scene.dispose()}},{key:"onWindowResize",value:function(){if(this.container=document.getElementById("anim-container"),this.container&&this.camera){this.renderer.domElement;this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}}},{key:"setupSimulation",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.initScene(),this.myState.statusMessage="loading agents",e.next=4,this.loadTrips();case 4:return this.finishedLoadingTrips(),e.next=7,this.addNetworkToScene();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startSimulation",value:function(){this.$emit("loaded",!0),this.myState.isShowingHelp||(this.clock.start(),this.animate(),this.myState.isRunning=!0)}},{key:"networkLayerAdder",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,r,s,o,l,c,u,h,d,p,m,f,v,b,g,y=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=2e4,!(a>i.length)){e.next=5;break}return this.myState.statusMessage="",this.startSimulation(),e.abrupt("return");case 5:for(r=[],s=a,o=a+n>i.length?i.length:a+n,l=0,c=s;c<o;c++)u=i[c],h=t[u.from],d=t[u.to],h&&d?(p=new fa["x"](h.x,h.y,0),m=new fa["x"](d.x,d.y,0),f=(new fa["b"]).setFromPoints([p,m]),r.push(f)):(l++,l<20&&console.log({badlink:u}));v=ma["a"].mergeBufferGeometries(r),b=new fa["j"](v,this.linkMaterial),b.name="network"+a,this.scene.add(b),this.camera&&this.renderer.render(this.scene,this.camera),this.networkLayers.push(b),v.dispose(),g=a+n,setTimeout((function(){y.networkLayerAdder(t,i,g)}),1);case 19:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"createNodesAndLinksFromXML",value:function(e){var t,i=e,a=i.network.nodes[0].node,n=i.network.links[0].link,r=Object(m["a"])(a);try{for(r.s();!(t=r.n()).done;){var s=t.value,o=s.$;o.x=parseFloat(o.x),o.y=parseFloat(o.y),this.network.nodes[o.id]=o}}catch(d){r.e(d)}finally{r.f()}var l,c=Object(m["a"])(n);try{for(c.s();!(l=c.n()).done;){var u=l.value,h=u.$;this.network.links[h.id]=h}}catch(d){c.e(d)}finally{c.f()}}},{key:"addNetworkToScene",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="loading network",this.networkLayers=[],e.prev=2,this.myState.fileSystem){e.next=5;break}return e.abrupt("return");case 5:return console.log({vizDetails:this.vizDetails}),e.next=8,_a.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 8:return this._roadFetcher=e.sent,e.next=11,this._roadFetcher.fetchXML();case 11:for(a in t=e.sent,this._roadFetcher.destroy(),console.log({xml:t}),this.createNodesAndLinksFromXML(t),i={},this.network.nodes)n=this.network.nodes[a],i[a]={x:n.x-this.midpointX,y:n.y-this.midpointY};this.networkLayerAdder(i,Object.values(this.network.links),0),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),console.error({e:e.t0}),this.myState.statusMessage=""+e.t0;case 24:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTrips",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tripList={},e.prev=1,e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 4:t=e.sent,i=Object(m["a"])(t.split("\n"));try{for(i.s();!(a=i.n()).done;)n=a.value,n&&(r=JSON.parse(n),this.tripList[r.id]=r)}catch(s){i.e(s)}finally{i.f()}e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"finishedLoadingTrips",value:function(){this.agentGeometry&&this.agentGeometry.dispose(),this.agentGeometry=new ba(this.tripList,this.midpointX,this.midpointY),this.agentMaterial||(this.agentMaterial=new fa["q"]({uniforms:{simulationTime:{value:0},colorLinks:{value:new fa["d"](this.colors.links)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,blending:fa["l"],depthTest:!0,transparent:!0}));var e=new fa["n"](this.agentGeometry,this.agentMaterial);e.name="agents";var t=this.scene.getObjectByName("agents");t&&this.scene.remove(t),this.scene.add(e),this.camera&&this.renderer.render(this.scene,this.camera),this.myState.statusMessage="loading network"}},{key:"initScene",value:function(){if(this.container=document.getElementById("anim-container"),this.container){this.scene.background=new fa["d"](this.colors.background),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.container.appendChild(this.renderer.domElement);var e=1,t=1e5;this.camera=new fa["m"](170,this.container.clientWidth/this.container.clientHeight,e,t),this.cameraControls=new this.OrbitControl.MapControls(this.camera,this.renderer.domElement),this.cameraControls.enablePan=!0,this.cameraControls.screenSpacePanning=!0,this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!1,this.camera.position.set(0,0,750),this.camera.lookAt(0,0,-1),this.cameraControls.update(),this.renderer.render(this.scene,this.camera)}}},{key:"moveCameraWhilePaused",value:function(){this.camera&&(this.myState.isRunning||(this.renderer.render(this.scene,this.camera),this.cameraControls.update(),requestAnimationFrame(this.moveCameraWhilePaused)))}},{key:"setVisibleClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock=(e<10?"0":"")+e+(t<10?":0":":")+t}},{key:"animate",value:function(){var e=this.clock.getElapsedTime(),t=this.timeFactor*this.speed*(e-this.animationTimeSinceUnpaused);this.animationTimeSinceUnpaused=e,this.simulationTime=this.simulationTime+t,this.simulationTime<0&&(this.myState.isRunning=!1,this.simulationTime=0),this.agentMaterial&&(this.agentMaterial.uniforms["simulationTime"].value=this.simulationTime),this.simulationTime*this.timeDirection>=this.nextClockUpdateTime*this.timeDirection&&(this.setVisibleClock(),this.nextClockUpdateTime+=60*this.timeDirection,ja.$emit(ja.SIMULATION_PERCENT,this.simulationTime/86400)),this.camera&&this.renderer.render(this.scene,this.camera),this.cameraControls.update(),this.myState.isRunning&&requestAnimationFrame(this.animate)}}]),n}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Ra.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ra.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ra.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ra.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Ra.prototype,"speed",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Ra.prototype,"vizState",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Ra.prototype,"vizDetails",void 0),Object(w["a"])([Object(O["d"])("speed")],Ra.prototype,"speedChanged",null),Object(w["a"])([Object(O["d"])("myState.isRunning")],Ra.prototype,"playPauseSim",null),Object(w["a"])([Object(O["d"])("myState.colorScheme")],Ra.prototype,"switchColorScheme",null),Ra=Object(w["a"])([O["a"]],Ra);var Ea=Ra,Aa=Ea,La=(i("beb0"),Object(_["a"])(Aa,da,pa,!1,null,"2faac81a",null)),Ma=La.exports,Fa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal"},[i("div",{staticClass:"modal-background"}),i("div",{staticClass:"modal-card"},[i("header",{staticClass:"modal-card-head"},[i("p",{staticClass:"modal-card-title"},[e._v(e._s(e.title))]),i("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){return e.clicked("close")}}})]),i("section",{staticClass:"modal-card-body"},[i("div",{staticClass:"content"},[i("div",{staticClass:"my-html",domProps:{innerHTML:e._s(e.html)}})])]),i("footer",{staticClass:"modal-card-foot"},[1==e.buttons.length?i("button",{staticClass:"button is-link",on:{click:function(t){return e.clicked(e.buttons[0])}}},[e._v(e._s(e.buttons[0]))]):e._e(),e._l(e.buttons.slice(1),(function(t){return i("button",{key:t,staticClass:"button",on:{click:function(i){return e.clicked(t)}}},[e._v(e._s(t))])}))],2)])])},Pa=[],Da=function(e){Object(k["a"])(a,e);var t=Object(S["a"])(a);function a(){var e;return Object(g["a"])(this,a),e=t.apply(this,arguments),e.html="",e}return Object(y["a"])(a,[{key:"mounted",value:function(){this.html=i("818f")}},{key:"clicked",value:function(e){this.$emit("click",e)}}]),a}(O["c"]);Object(w["a"])([Object(O["b"])({required:!0})],Da.prototype,"title",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Da.prototype,"md",void 0),Object(w["a"])([Object(O["b"])({required:!0})],Da.prototype,"buttons",void 0),Da=Object(w["a"])([Object(O["a"])({components:{},props:{}})],Da);var za=Da,Ia=za,Na=(i("a722"),Object(_["a"])(Ia,Fa,Pa,!1,null,"5b9cdc97",null)),Ba=Na.exports,Ha=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:""},e.myState={statusMessage:"",clock:"00:00",colorScheme:a.DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=p.state,e.isDarkMode=e.myState.colorScheme===a.DarkMode,e.isLoaded=!1,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e}return Object(y["a"])(i,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 11:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,fe.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===a.DarkMode,this.updateLegendColors()}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){var e=this.myState.colorScheme==a.LightMode?c:u;this.legendBits=[{label:"susceptible",color:e.susceptible},{label:"latently infected",color:e.infectedButNotContagious},{label:"contagious",color:e.contagious},{label:"symptomatic",color:e.symptomatic},{label:"seriously ill",color:e.seriouslyIll},{label:"critical",color:e.critical},{label:"recovered",color:e.recovered}]}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.myState.isRunning&&0===this.speed&&(this.speed=1)}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.showHelp=!1,this.updateLegendColors();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){p.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"clickedHelp",value:function(){console.log("HEEELP!"),this.myState.isRunning=!1,this.showHelp=!0,this.myState.isShowingHelp=this.showHelp}},{key:"clickedCloseHelp",value:function(){this.showHelp=!1,this.myState.isShowingHelp=this.showHelp,this.myState.isRunning=!0}},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===a.DarkMode?a.LightMode:a.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===a.DarkMode?t:e}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Ha.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ha.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ha.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ha.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Ha.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("state.colorScheme")],Ha.prototype,"swapTheme",null),Ha=Object(w["a"])([Object(O["a"])({components:{AnimationView:Ma,ModalMarkdownDialog:Ba,PlaybackControls:Ue,VueSlider:de.a,ToggleButton:pe["ToggleButton"]}})],Ha),p.commit("registerPlugin",{kebabName:"agent-animation",prettyName:"Agent Animation",description:"birds",filePatterns:["viz-agent-anim*.y?(a)ml"],component:Ha});var Va=Ha,$a=Va,qa=(i("36a2"),Object(_["a"])($a,ua,ha,!1,null,"73f031bc",null)),Ua=qa.exports,Ya=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"link-container",style:{background:e.urlThumbnail}},[e.thumbnail?e._e():i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.myState.loadingText?e._e():i("left-data-panel",{staticClass:"left-panel"},[i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 1rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.headers.length>2,expression:"headers.length > 2"}],staticClass:"uhrzeit"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);a.checked?s<0&&(e.showTimeRange=i.concat([r])):s>-1&&(e.showTimeRange=i.slice(0,s).concat(i.slice(s+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")])],1),i("h4",{staticClass:"heading"},[e._v("Linienbreiten")]),e.headers.length>0?i("scale-slider",{staticClass:"time-slider",attrs:{stops:e.SCALE_STOPS},on:{change:e.bounceScale}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showAllRoads,expression:"showAllRoads"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showAllRoads)?e._i(e.showAllRoads,null)>-1:e.showAllRoads},on:{change:function(t){var i=e.showAllRoads,a=t.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);a.checked?s<0&&(e.showAllRoads=i.concat([r])):s>-1&&(e.showAllRoads=i.slice(0,s).concat(i.slice(s+1)))}else e.showAllRoads=n}}}),e._v(" Gesamtes Straßennetz anzeigen")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.loadingText,expression:"myState.loadingText"}],staticClass:"status-blob"},[i("h4",[e._v(e._s(e.myState.loadingText))])])],1)},Ga=[],Xa=(i("498a"),i("c26a")),Wa=i("b012"),Ja=i("e192"),Za=i.n(Ja),Ka=i("323e"),Qa=i.n(Ka),en=i("369b"),tn=i.n(en),an=i("a79f"),nn=i("595b");function rn(e,t){return Object(an["a"])(e,"WGS84",t)}an["a"].defs([["EPSG:2048","+proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:31468","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs"],["EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs"],["EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs"]]),an["a"].defs("DK4",an["a"].defs("EPSG:31468")),an["a"].defs("GK4",an["a"].defs("EPSG:31468")),an["a"].defs("Cottbus",an["a"].defs("EPSG:25833")),an["a"].defs("Berlin",an["a"].defs("EPSG:31468")),an["a"].defs("South Africa",an["a"].defs("EPSG:2048"));var sn={toLngLat:rn},on=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"datapanel"}},[i("div",{staticClass:"content-area",class:{"is-hidden":e.isHidden,bye:e.isLeaving}},[e.title?i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{padding:"0.5rem 3rem","font-size":"1rem","font-weight":"normal",color:"white"}},[e._v(e._s(e.title))])]):e._e(),i("div",{staticClass:"top-area"},[e._t("default")],2)]),i("div",{staticClass:"restore-button",class:{"add-margin":!e.isHidden}},[i("button",{staticClass:"button is-small hide-button",on:{click:e.toggleHidePanel}},[e.isHidden?e._e():i("i",{staticClass:"fa fa-arrow-left"}),e.isHidden?i("i",{staticClass:"fa fa-arrow-right"}):e._e()])])])},ln=[],cn=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.isHidden=!1,e.isLeaving=!1,e}return Object(y["a"])(i,[{key:"toggleHidePanel",value:function(){var e=this;this.isHidden?this.isHidden=!this.isHidden:(this.isLeaving=!0,setTimeout((function(){e.isHidden=!0,e.isLeaving=!1}),300))}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({type:String})],cn.prototype,"title",void 0),cn=Object(w["a"])([O["a"]],cn);var un=cn,hn=un,dn=(i("90da"),Object(_["a"])(hn,on,ln,!1,null,"82194458",null)),pn=dn.exports,mn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},fn=[],vn=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=1,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(y["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.scaleSlider.data=this.stops}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!0})],vn.prototype,"stops",void 0),Object(w["a"])([Object(O["d"])("sliderValue")],vn.prototype,"sliderChangedEvent",null),vn=Object(w["a"])([Object(O["a"])({components:{"vue-slider":de.a}})],vn);var bn=vn,gn=bn,yn=(i("acace"),Object(_["a"])(gn,mn,fn,!1,null,"2fde1874",null)),kn=yn.exports,Sn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},wn=[],On=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(y["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=Be(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=Be(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}},{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])()],On.prototype,"initialTime",void 0),Object(w["a"])([Object(O["b"])()],On.prototype,"useRange",void 0),Object(w["a"])([Object(O["b"])()],On.prototype,"stops",void 0),Object(w["a"])([Object(O["d"])("initialTime")],On.prototype,"initialTimeChanged",null),Object(w["a"])([Object(O["d"])("useRange")],On.prototype,"changeUseRange",null),Object(w["a"])([Object(O["d"])("stops")],On.prototype,"setStops",null),Object(w["a"])([Object(O["d"])("sliderValue")],On.prototype,"sliderChangedEvent",null),On=Object(w["a"])([Object(O["a"])({components:{"vue-slider":de.a}})],On);var xn=On,jn=xn,Cn=(i("83c7"),Object(_["a"])(jn,Sn,wn,!1,null,"e2ace8c0",null)),Tn=Cn.exports,_n=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.SCALE_STOPS=[.01,.1,.2,.5,1,2,5,10,100],e.WIDTH_SCALE=.005,e.globalState=p.state,e.showAllRoads=!1,e.mapExtentXYXY=[180,90,-180,-90],e.mapId="m".concat(Math.floor(Math.random()*Math.floor(1e10))),e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,loadingText:"Dateien laden...",visualization:null,project:{}},e.vizDetails={csvFile:"",csvFile2:"",shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,title:"",description:"",thumbnail:"",sum:!1},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.sampleRate=1,e.geojson={},e.headers=[],e.showTimeRange=!1,e.bounceTimeSlider=Object(Wa["debounce"])(e.changedTimeSlider,200),e.bounceScale=Object(Wa["debounce"])(e.changedScale,200),e.currentTimeBin=e.TOTAL_MSG,e.currentScale=e.SCALE_STOPS[0],e.sumElements=[],e.dataset={},e.idLookup={},e.dailyGrandTotal=0,e.dailyTotals=[],e.idColumn="",e.hoveredStateId=null,e.currentChart={},e}return Object(y["a"])(i,[{key:"toggleShowAllRoads",value:function(){this.changedTimeSlider(this.currentTimeBin)}},{key:"toggleShowTimeRange",value:function(){!this.showTimeRange&&this.headers.length&&(this.currentTimeBin=this.headers[0]),this.changedTimeSlider(this.currentTimeBin)}},{key:"destroyed",value:function(){p.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=7;break}return this.myState.loadingText="",e.abrupt("return");case 7:this.generateBreadcrumbs(),this.setupMap();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this.mapExtentXYXY[0]=Math.min(this.mapExtentXYXY[0],e[0]),this.mapExtentXYXY[1]=Math.min(this.mapExtentXYXY[1],e[1]),this.mapExtentXYXY[2]=Math.max(this.mapExtentXYXY[2],e[0]),this.mapExtentXYXY[3]=Math.max(this.mapExtentXYXY[3],e[1])}},{key:"setMapExtent",value:function(){this.mapExtentXYXY=Object(nn["bbox"])(this.geojson),localStorage.setItem(this.myState.subfolder+"-bounds",JSON.stringify(this.mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:10,bottom:10,right:10,left:250},animate:!1};this.map.fitBounds(this.mapExtentXYXY,e)}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"setupMap",value:function(){try{this.map=new Za.a.Map({bearing:0,container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/streets-v11",pitch:0}),this.findCenter(),this.map.on("style.load",this.mapIsReady),this.map.addControl(new Za.a.NavigationControl,"top-right")}catch(e){console.log(e)}}},{key:"findCenter",value:function(){try{var e=localStorage.getItem(this.myState.subfolder+"-bounds");if(e){var t=JSON.parse(e),i={top:5,bottom:5,right:5,left:30};this.thumbnail?this.map.fitBounds(t,{animate:!1}):this.map.fitBounds(t,{padding:i,animate:!1})}}catch(a){}}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.vizDetails.shpFileIdProperty||(this.vizDetails.shpFileIdProperty="Id"),this.sampleRate=this.vizDetails.sampleRate?this.vizDetails.sampleRate:1,this.buildThumbnail(),Qa.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,fe.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.myState.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile);case 4:if(t=e.sent,i="",!this.vizDetails.csvFile2){e.next=10;break}return e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile2);case 9:i=e.sent;case 10:if(a=null,n=null,r=null,!this.vizDetails.geojsonFile){e.next=28;break}return console.log("reading",this.vizDetails.geojsonFile),e.next=17,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.geojsonFile);case 17:if(s=e.sent,!s){e.next=24;break}return e.next=21,Object(xe["a"])(s);case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=null;case 25:r=e.t0,e.next=41;break;case 28:return console.log("reading",this.vizDetails.shpFile),e.next=31,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.shpFile);case 31:return o=e.sent,e.next=34,fe.a.arraybuffer(o);case 34:return a=e.sent,e.next=37,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.dbfFile);case 37:return l=e.sent,e.next=40,fe.a.arraybuffer(l);case 40:n=e.sent;case 41:return e.abrupt("return",{shpFile:a,dbfFile:n,linkFlows:i||t,linkBaseFlows:i?t:i,geojsonFile:r});case 44:return e.prev=44,e.t1=e["catch"](0),console.error({e:e.t1}),this.myState.loadingText=""+e.t1,e.abrupt("return",null);case 49:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedTimeSlider",value:function(e){e.length&&1===e.length&&(e=e[0]),this.currentTimeBin=e;var t=this.WIDTH_SCALE*this.currentScale;if(0==this.showTimeRange){this.map.setPaintProperty("my-layer","line-width",["*",t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#ff0",["==",["get",e],null],"#8ca",["<",["get",e],0],"#5f5",this.vizDetails.csvFile2?"#900":"#55b"]);var i=this.showAllRoads?null:["!=",["get",this.currentTimeBin],null];this.map.setFilter("my-layer",i)}else{var a,n=["+"],r=!1,s=Object(m["a"])(this.headers);try{for(s.s();!(a=s.n()).done;){var o=a.value;o===e[0]&&(r=!0),o!==this.TOTAL_MSG&&(r&&n.push(["get",o]),o===e[1]&&(r=!1))}}catch(l){s.e(l)}finally{s.f()}this.map.setPaintProperty("my-layer","line-width",["*",t,n]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,n]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#0f6",["==",n,null],"#8ca",["<",n,0],"#fc0","#559"])}}},{key:"processHeaders",value:function(e){var t=e.split("\n"),i=t[0].indexOf(";")>0?";":",",a=t[0].split(i).map((function(e){return e.trim()}));this.headers=[this.TOTAL_MSG].concat(a.slice(1))}},{key:"processGeojsonFile",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,je["run"](Oe.a.inflateAsync(t.geojsonFile,{to:"string"}));case 3:return i=e.sent,a=JSON.parse(i),n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",r=0,e.next=9,je["forEachAsync"](a.features,(function(e){e.properties&&(e.id=r++,s.idLookup[e.properties[n]]=e.id)}));case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"processShapefile",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,Xa["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,this.myState.loadingText="Converting coordinates...",a=0,n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",r=0,e.next=10,je["forEachAsync"](i.features,(function(e){e.properties&&(e.id=r++,s.idLookup[e.properties[n]]=e.id);try{"MultiPolygon"===e.geometry.type?s.convertMultiPolygonCoordinatesToWGS84(e):"LineString"===e.geometry.type?s.convertLineStringCoordinatesToWGS84(e):s.convertPolygonCoordinatesToWGS84(e)}catch(t){a++,a<5&&(console.error("ERR with feature: "+e),console.error(t))}}));case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertLineStringCoordinatesToWGS84",value:function(e){var t,i=[],a=e.geometry.coordinates,n=Object(m["a"])(a);try{for(n.s();!(t=n.n()).done;){var r=t.value,s=sn.toLngLat(this.vizDetails.projection,r);i.push(s),this.updateMapExtent(s)}}catch(o){n.e(o)}finally{n.f()}a.length=0,a.push.apply(a,i)}},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(m["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=[],s=Object(m["a"])(n);try{for(s.s();!(a=s.n()).done;){var o=a.value,l=sn.toLngLat(this.vizDetails.projection,o);r.push(l)}}catch(c){s.e(c)}finally{s.f()}n.length=0,n.push.apply(n,r)}}catch(c){i.e(c)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(m["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=n[0],s=[],o=Object(m["a"])(r);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Object(an["a"])(this.vizDetails.projection,"WGS84",l);s.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=s}}catch(u){i.e(u)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(m["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(an["a"])(this.vizDetails.projection,"WGS84",n))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"mapIsReady",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,t){e.next=6;break}return this.myState.loadingText="Fehler mit Dateien, sorry",e.abrupt("return");case 6:if(!this.vizDetails.geojsonFile){e.next=12;break}return e.next=9,this.processGeojsonFile(t);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.processShapefile(t);case 14:e.t0=e.sent;case 15:return this.geojson=e.t0,this.setMapExtent(),e.next=19,this.processCSVFiles(t);case 19:return this.processHeaders(t.linkFlows),e.next=22,this.calculateLinkProperties(this.geojson);case 22:return this.addJsonToMap(this.geojson),this.changedScale(1),this.setupMapListeners(),this.myState.loadingText="",e.next=28,this.$nextTick();case 28:Qa.a.done();case 29:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCSVFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.dataset={},i=",";try{a=t.linkFlows.substring(0,t.linkFlows.indexOf("\n")),a.indexOf(",")>-1?i=",":a.indexOf(";")>-1?i=";":a.indexOf("\t")>-1?i="\t":a.indexOf(" ")>-1&&(i=" ")}catch(o){i=","}return n=tn.a.parse(t.linkFlows,{header:!0,dynamicTyping:!0,delimiter:i}),r=n.meta.fields[0],this.idColumn=r,e.next=8,je["forEachAsync"](n.data,(function(e){var t=e[r],i=s.idLookup[t];s.dataset[i]=e}));case 8:if(!t.linkBaseFlows){e.next=11;break}return e.next=11,this.subtractBaseFlows(t.linkBaseFlows,i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subtractBaseFlows",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText=this.vizDetails.sum?"Summen berechnen...":"Differenzen berechnen...",a=tn.a.parse(t,{header:!0,dynamicTyping:!0,delimiter:i}),n=a.meta.fields[0],r=0,e.next=6,je["forEachAsync"](a.data,(function(e){var t=e[n],i=s.idLookup[t];if(s.dataset[i]){var a=s.dataset[i];if(s.vizDetails.sum)for(var o=0,l=Object.keys(e);o<l.length;o++){var c=l[o];a[c]=a[c]+e[c]}else for(var u=0,h=Object.keys(e);u<h.length;u++){var d=h[u];a[d]=a[d]-e[d]}s.dataset[i]=a,r++}else{if(!s.vizDetails.sum)for(var p=0,m=Object.keys(e);p<m.length;p++){var f=m[p];isNaN(e[f])||(e[f]=-1*e[f])}s.dataset[i]=e}}));case 6:console.log(r,"total DIFFs happened");case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"calculateLinkProperties",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Berechnen...",e.next=3,je["forEachAsync"](t.features,(function(e){var t=e.id,a=i.dataset[t];if(a){for(var n=0,r=0,s=Object.keys(a);r<s.length;r++){var o=s[r];if(o!==i.idColumn&&!isNaN(a[o])){var l=a[o]/i.sampleRate;e.properties[o]=l,n+=l,i.dailyTotals[o]||(i.dailyTotals[o]=0),i.dailyTotals[o]+=l}}e.properties[i.TOTAL_MSG]=n}}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addJsonToMap",value:function(e){this.map&&(this.map.addSource("my-data",{data:e,type:"geojson"}),this.map.addLayer({id:"my-layer",source:"my-data",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-offset":["+",.25,["*",.5,["get","width"]]],"line-color":["case",["boolean",["feature-state","hover"],!1],"#fb0","#559"]},layout:{"line-cap":"round"}}))}},{key:"setupMapListeners",value:function(){var e=this;if(this.map){var t="my-layer",i=this;this.map.on("click",t,(function(t){e.clickedOnElement(t)})),this.map.on("mousemove",t,(function(t){e.map&&(e.map.getCanvas().style.cursor=t?"pointer":"auto")})),this.map.on("mouseleave",t,(function(){e.map&&(e.map.getCanvas().style.cursor="auto")})),this.map.on("mousemove",t,(function(e){var t=i.map.queryRenderedFeatures(e.point);t.length>0&&(i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=t[0].id,i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!0}))})),this.map.on("mouseleave",t,(function(){i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=null}))}}},{key:"clickedOnElement",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:if(i=t.features[0],a=[],n=0,!i.properties){e.next=28;break}r=this.headers,s=Object(m["a"])(r),e.prev=8,s.s();case 10:if((o=s.n()).done){e.next=20;break}if(l=o.value,l!==this.TOTAL_MSG){e.next=14;break}return e.abrupt("continue",18);case 14:c=i.properties[l],c||(c=0),n+=c,a.push({hour:l,trips:c});case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),s.e(e.t0);case 25:return e.prev=25,s.f(),e.finish(25);case 28:n||(n=0),u='<p style="text-align: center; min-width: max-content;"><b>Details</b><br/>Insgesamt: '+n+"</p>",n&&(u+='<div id="chart" style="width: 300px; height:250px;"></div>'),this._popup&&this._popup.remove(),this._popup=new Za.a.Popup({closeOnClick:!0}).setLngLat(t.lngLat).setHTML(u),this._popup.addTo(this.map),console.log({data:a}),n&&(this.currentChart=new Morris.Bar({element:"chart",data:a,stacked:!0,xkey:"hour",ykeys:["trips"],labels:["Trips"],barColors:["#3377cc"],xLabels:"Uhr",xLabelAngle:90,hideHover:!0,parseTime:!1,resize:!0}));case 36:case"end":return e.stop()}}),e,this,[[8,22,25,28]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],_n.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],_n.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],_n.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],_n.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("showAllRoads")],_n.prototype,"toggleShowAllRoads",null),Object(w["a"])([Object(O["d"])("showTimeRange")],_n.prototype,"toggleShowTimeRange",null),_n=Object(w["a"])([Object(O["a"])({components:{LeftDataPanel:pn,ScaleSlider:kn,TimeSlider:Tn}})],_n),p.commit("registerPlugin",{kebabName:"link-volumes",prettyName:"Volumes",description:"Aggregate volumes on network links",filePatterns:["viz-link*.y?(a)ml"],component:_n});var Rn=_n,En=Rn,An=(i("780e"),Object(_["a"])(En,Ya,Ga,!1,null,"ae413ea2",null)),Ln=An.exports,Mn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{staticClass:"sankey-container",class:{"show-thumbnail":e.myState.thumbnail}},[i("div",{staticClass:"main-area"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.vizDetails.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))]),i("p",{staticClass:"center"},[e._v(e._s(e.totalTrips.toLocaleString())+" total trips")])]),i("svg",{attrs:{id:e.cleanConfigId}})])]):e._e()},Fn=[],Pn=(i("caad"),i("ed18")),Dn=i("00a5"),zn=i("df19"),In=i("a968"),Nn=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csv:"",title:"",description:""},e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(y["a"])(i,[{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:t=e.sent,t&&(this.jsonChart=this.processInputs(t)),this.loadingText="",this.doD3(),Qa.a.done();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loadingText="Loading files...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 4:return t=e.sent,this.vizDetails=le.a.parse(t),this.$emit("title",this.vizDetails.title),e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csv);case 9:return i=e.sent,e.abrupt("return",{flows:i});case 13:e.prev=13,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 18:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(e){this.loadingText="Building node graph...";var t=[],i=[],a=[];this.totalTrips=0;var n,r=e.flows.split("\n"),s=Object(m["a"])(r.slice(1));try{for(s.s();!(n=s.n()).done;){var o=n.value,l=o.trim().split(";");if(l&&!(l.length<2)){t.includes(l[0])||t.push(l[0]),i.includes(l[1])||i.push(l[1]);var c=parseFloat(l[2]);c>0&&(a.push([l[0],l[1],c]),this.totalTrips+=c)}}}catch(b){s.e(b)}finally{s.f()}var u={nodes:[],links:[]},h={},d={};t.forEach((function(e,t){u.nodes.push({id:t,title:e}),h[e]=t})),i.forEach((function(e,i){u.nodes.push({id:i+t.length,title:e}),d[e]=i+t.length}));for(var p=0,f=a;p<f.length;p++){var v=f[p];u.links.push({source:h[v[0]],target:d[v[1]],value:v[2]})}return u}},{key:"doD3",value:function(){var e=this.jsonChart;e.order=[[[4,1,2,3,0,5]],[[6,7,8,9,10,11]]],e.alignTypes=!0,e.alignLinkTypes=!0;var t=Object(Pn["sankey"])().extent([[100,100],[700,600]]).nodeWidth(3),i=Object(zn["a"])(In["a"]),a=Object(Pn["sankeyDiagram"])().linkColor((function(e){var t=i(e.source.id);return t+"bb"}));Object(Dn["a"])("#"+this.cleanConfigId).datum(t(e)).call(a).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 800 800")}},{key:"cleanConfigId",get:function(){var e=this.myState.yamlConfig.replace(/[\W_]+/g,"");return e}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Nn.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nn.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nn.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Nn.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Nn.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("yamlConfig")],Nn.prototype,"changedYaml",null),Object(w["a"])([Object(O["d"])("subfolder")],Nn.prototype,"changedSubfolder",null),Nn=Object(w["a"])([Object(O["a"])({components:{}})],Nn),p.commit("registerPlugin",{kebabName:"sankey-diagram",prettyName:"Flow Diagram",description:"Depicts flows between choices",filePatterns:["sankey*.y?(a)ml"],component:Nn});var Bn=Nn,Hn=Bn,Vn=(i("66bf"),Object(_["a"])(Hn,Mn,Fn,!1,null,"e3d72f9a",null)),$n=Vn.exports,qn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{attrs:{id:"vega-container"}},[i("div",{staticClass:"main-area"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.thumbnail,expression:"myState.thumbnail"}],staticClass:"labels"},[i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.description))])]),e.hasFacets?i("div",{staticClass:"chart-area center-chart"},[i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})]):e._e(),e.hasFacets?e._e():i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})])]):e._e()},Un=[],Yn=i("87e7"),Gn=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={title:"",description:""},e.title="",e.description="",e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(y["a"])(i,[{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:this.thumbnail||this.generateBreadcrumbs();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:this.vizDetails=e.sent,this.vizDetails&&(this.jsonChart=this.processInputs()),this.loadingText="",Qa.a.done();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={data:{}},e.prev=1,this.loadingText="Loading chart...",e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.description=t.description?t.description:"",this.title=t.title?t.title:this.myState.yamlConfig.substring(0,this.myState.yamlConfig.length-10).replace(/_/g," "),this.$emit("title",this.title),e.next=17;break;case 11:return e.prev=11,e.t0=e["catch"](1),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url),e.abrupt("return");case 17:if(!t.data.url){e.next=38;break}if(e.prev=18,i="",a=this.myState.subfolder+"/"+t.data.url,!t.data.url.endsWith(".json")){e.next=28;break}return e.next=24,this.myState.fileApi.getFileJson(a);case 24:i=e.sent,i&&(t.data={values:i}),e.next=33;break;case 28:if(!t.data.url.endsWith(".csv")){e.next=33;break}return e.next=31,this.myState.fileApi.getFileText(a);case 31:i=e.sent,i&&(t.data={values:i,format:{type:"csv"}});case 33:e.next=38;break;case 35:e.prev=35,e.t1=e["catch"](18),console.warn(e.t1);case 38:return e.abrupt("return",t);case 39:case"end":return e.stop()}}),e,this,[[1,11],[18,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){this.loadingText="Building chart...";var e={export:!0,source:!1,compiled:!1,editor:!1},t={actions:!this.thumbnail&&e,hover:!0,scaleFactor:2,padding:{top:2,left:8,right:8,bottom:8}};if(this.thumbnail&&this.vizDetails.encoding)for(var i=0,a=Object.keys(this.vizDetails.encoding);i<a.length;i++){var n=a[i];this.vizDetails.encoding[n].legend=null}Object(Yn["a"])("#".concat(this.cleanConfigId),this.vizDetails,t)}},{key:"cleanConfigId",get:function(){return this.myState.yamlConfig.replace(/[\W_]+/g,"")}},{key:"hasFacets",get:function(){return!!this.vizDetails&&(!!this.vizDetails.encoding&&!!(this.vizDetails.encoding.facet||this.vizDetails.encoding.row||this.vizDetails.encoding.column))}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Gn.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Gn.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Gn.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Gn.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Gn.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("yamlConfig")],Gn.prototype,"changedYaml",null),Object(w["a"])([Object(O["d"])("subfolder")],Gn.prototype,"changedSubfolder",null),Gn=Object(w["a"])([Object(O["a"])({components:{}})],Gn),p.commit("registerPlugin",{kebabName:"vega-lite",prettyName:"Chart",description:"Interactive chart visualization",filePatterns:["*.vega.json"],component:Gn});var Xn=Gn,Wn=Xn,Jn=(i("0c3c"),Object(_["a"])(Wn,qn,Un,!1,null,"664f8ede",null)),Zn=Jn.exports,Kn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mycomponent",attrs:{id:e.containerId}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.thumbnail&&e.loadingText,expression:"!thumbnail && loadingText"}],staticClass:"status-blob"},[i("p",[e._v(e._s(e.loadingText))])]),e.thumbnail||e.isMobile()?e._e():i("div",{staticClass:"map-complications"},[i("legend-box",{staticClass:"complication",attrs:{rows:e.legendRows}}),i("scale-box",{staticClass:"complication",attrs:{rows:e.scaleRows}})],1),i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.loadingText?e._e():i("left-data-panel",{staticClass:"left-panel"},[i("div",{staticClass:"dashboard-panel"},[i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 3rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);a.checked?s<0&&(e.showTimeRange=i.concat([r])):s>-1&&(e.showTimeRange=i.slice(0,s).concat(i.slice(s+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")]),i("h4",{staticClass:"heading"},[e._v("Kreise")]),i("div",{staticClass:"white-box"},[i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroids,expression:"showCentroids"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroids)?e._i(e.showCentroids,null)>-1:e.showCentroids},on:{change:function(t){var i=e.showCentroids,a=t.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);a.checked?s<0&&(e.showCentroids=i.concat([r])):s>-1&&(e.showCentroids=i.slice(0,s).concat(i.slice(s+1)))}else e.showCentroids=n}}}),e._v(" Kreise anzeigen")]),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroidLabels,expression:"showCentroidLabels"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroidLabels)?e._i(e.showCentroidLabels,null)>-1:e.showCentroidLabels},on:{change:function(t){var i=e.showCentroidLabels,a=t.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=e._i(i,r);a.checked?s<0&&(e.showCentroidLabels=i.concat([r])):s>-1&&(e.showCentroidLabels=i.slice(0,s).concat(i.slice(s+1)))}else e.showCentroidLabels=n}}}),e._v(" Nummern anzeigen")])]),i("h4",{staticClass:"heading"},[e._v("Strecken")]),i("div",{staticClass:"white-box"},[i("div",{staticClass:"subheading"},[e._v("Linienbreiten")]),i("scale-slider",{staticClass:"scale-slider",attrs:{stops:e.scaleValues,initialTime:1},on:{change:e.bounceScaleSlider}}),i("div",{staticClass:"subheading"},[e._v("Ausblenden bis")]),i("line-filter-slider",{staticClass:"scale-slider",attrs:{initialValue:e.lineFilter},on:{change:e.bounceLineFilter}})],1),i("h4",{staticClass:"heading"},[e._v("Insgesamt für")]),i("div",{staticClass:"buttons-bar"},[i("button",{staticClass:"button",class:{"is-link":e.isOrigin,"is-active":e.isOrigin},on:{click:e.clickedOrigins}},[e._v("Quellen")]),i("button",{staticClass:"button",class:{"is-link":!e.isOrigin,"is-active":!e.isOrigin},attrs:{hint:"hide"},on:{click:e.clickedDestinations}},[e._v("Zielorte")])])],1)])])],1)},Qn=[],er=(i("cb29"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("p",{staticClass:"title"},[e._v("Legende:")]),e._l(e.rows,(function(t){return i("div",{staticClass:"legend-item"},["string"===typeof t&&t.includes("#")?i("div",{staticClass:"legend-col",style:{"background-color":t}}):e._e(),"string"!==typeof t||t.includes("#")||"↓"!=t?e._e():i("div",{staticClass:"legend-element1"},[e._v(e._s(t))]),"string"!==typeof t||t.includes("#")||"↓"==t?e._e():i("div",{staticClass:"legend-element2"},[e._v(e._s(t))])])}))],2)}),tr=[],ir=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"created",value:function(){}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({type:Array,required:!0})],ir.prototype,"rows",void 0),ir=Object(w["a"])([O["a"]],ir);var ar=ir,nr=ar,rr=(i("31ec"),Object(_["a"])(nr,er,tr,!1,null,"64318484",null)),sr=rr.exports,or=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},lr=[],cr=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:0,data:[0,1,2,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,"Alle"],marks:[0,25,50,75,"Alle"],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom"},e}return Object(y["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.sliderValue=this.initialValue}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){console.log(e),this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])()],cr.prototype,"initialValue",void 0),Object(w["a"])([Object(O["b"])()],cr.prototype,"useRange",void 0),Object(w["a"])([Object(O["b"])()],cr.prototype,"stops",void 0),Object(w["a"])([Object(O["d"])("stops")],cr.prototype,"setStops",null),Object(w["a"])([Object(O["d"])("sliderValue")],cr.prototype,"sliderChangedEvent",null),cr=Object(w["a"])([Object(O["a"])({components:{"vue-slider":de.a}})],cr);var ur=cr,hr=ur,dr=(i("f0aa"),Object(_["a"])(hr,or,lr,!1,null,"25daa34f",null)),pr=dr.exports,mr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"scale-container"}},[i("p",{staticClass:"title"},[e._v("Linienbreite:")]),i("div",{staticClass:"scale-element"},[e._v(e._s("|↔︎|"))]),i("div",{staticClass:"scale-scale"},[e._v(e._s("~ "+this.rows[0]+" Fahrten"))]),i("p")])},fr=[],vr=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"created",value:function(){}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({type:Array,required:!0})],vr.prototype,"rows",void 0),vr=Object(w["a"])([O["a"]],vr);var br=vr,gr=br,yr=(i("b8ce"),Object(_["a"])(gr,mr,fr,!1,null,"487e92bd",null)),kr=yr.exports,Sr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},wr=[],Or=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="All >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(y["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=Be(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=Be(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}},{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])()],Or.prototype,"initialTime",void 0),Object(w["a"])([Object(O["b"])()],Or.prototype,"useRange",void 0),Object(w["a"])([Object(O["b"])()],Or.prototype,"stops",void 0),Object(w["a"])([Object(O["d"])("initialTime")],Or.prototype,"initialTimeChanged",null),Object(w["a"])([Object(O["d"])("useRange")],Or.prototype,"changeUseRange",null),Object(w["a"])([Object(O["d"])("stops")],Or.prototype,"setStops",null),Object(w["a"])([Object(O["d"])("sliderValue")],Or.prototype,"sliderChangedEvent",null),Or=Object(w["a"])([Object(O["a"])({components:{"vue-slider":de.a}})],Or);var xr=Or,jr=xr,Cr=(i("fc60"),Object(_["a"])(jr,Sr,wr,!1,null,"9a42ac2e",null)),Tr=Cr.exports,_r="Alle >>",Rr=0,Er=[1,3,5,10,25,50,100,150,200,300,400,450,500],Ar=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csvFile:"",shpFile:"",dbfFile:"",projection:"",scaleFactor:1,title:"",description:""},e.containerId="c".concat(Math.floor(Math.random()*Math.floor(1e10))),e.mapId="map-"+e.containerId,e.centroids={},e.centroidSource={},e.linkData={},e.spiderLinkFeatureCollection={},e.zoneData={},e.dailyData={},e.marginals={},e.hoveredStateId=0,e.rowName="",e.colName="",e.headers=[],e.geojson={},e.idColumn="",e.showTimeRange=!1,e.showCentroids=!0,e.showCentroidLabels=!0,e.isOrigin=!0,e.selectedCentroid=0,e.maxZonalTotal=0,e.loadingText="Aggregierte Quell-Ziel Muster",e.project={},e.scaleFactor=1,e.sliderValue=[1,500],e.scaleValues=Er,e.currentScale=Er[0],e.currentTimeBin=_r,e.lineFilter=0,e.bounceTimeSlider=Object(Wa["debounce"])(e.changedTimeSlider,100),e.bounceScaleSlider=Object(Wa["debounce"])(e.changedScale,50),e.bounceLineFilter=Object(Wa["debounce"])(e.changedLineFilter,250),e}return Object(y["a"])(i,[{key:"created",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0;case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroyed",value:function(){p.commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.thumbnail||this.generateBreadcrumbs(),this.setupMap();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:this.setupMap();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clickedRange",value:function(e){console.log(e)}},{key:"clickedShowCentroids",value:function(){this.updateCentroidLabels()}},{key:"clickedShowCentroidBubbles",value:function(){this.updateCentroidLabels()}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 10:this.$emit("title",this.vizDetails.title),this.scaleFactor=this.vizDetails.scaleFactor,this.projection=this.vizDetails.projection,this.idColumn=this.vizDetails.idColumn?this.vizDetails.idColumn:"id",Qa.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csvFile);case 4:return t=e.sent,e.next=7,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.shpFile);case 7:return i=e.sent,e.next=10,fe.a.arraybuffer(i);case 10:return a=e.sent,e.next=13,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.dbfFile);case 13:return n=e.sent,e.next=16,fe.a.arraybuffer(n);case 16:return r=e.sent,e.abrupt("return",{shpFile:a,dbfFile:r,odFlows:t});case 20:return e.prev=20,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupMap",value:function(){this.mymap=new Za.a.Map({container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/outdoors-v9"});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(e){var t=JSON.parse(e),i=this.isMobile()?0:1,a={top:50*i,bottom:100*i,right:100*i,left:300*i};this.thumbnail?this.mymap.fitBounds(t,{animate:!1}):this.mymap.fitBounds(t,{padding:a,animate:!1})}}catch(y){}if(this.mymap.on("click",this.handleEmptyClick),this.mymap.on("load",this.mapIsReady),this.mymap.addControl(new Za.a.NavigationControl,"top-right"),this.thumbnail){var n,r=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact"),s=Object(m["a"])(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;o.setAttribute("style","display: none")}}catch(k){s.e(k)}finally{s.f()}r=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-group");var l,c=Object(m["a"])(r);try{for(c.s();!(l=c.n()).done;){var u=l.value;u.setAttribute("style","display: none")}}catch(k){c.e(k)}finally{c.f()}r=document.getElementsByClassName("mapboxgl-ctrl-logo");var h,d=Object(m["a"])(r);try{for(d.s();!(h=d.n()).done;){var p=h.value;p.setAttribute("style","display: none")}}catch(k){d.e(k)}finally{d.f()}}else{var f,v=document.getElementsByClassName("mapboxgl-ctrl-logo"),b=Object(m["a"])(v);try{for(b.s();!(f=b.n()).done;){var g=f.value;g.setAttribute("style","margin-bottom: 3rem;")}}catch(k){b.e(k)}finally{b.f()}}}},{key:"handleEmptyClick",value:function(e){this.fadeUnselectedLinks(-1),this.isMobile()}},{key:"mapIsReady",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,!t){e.next=18;break}return e.next=6,this.processShapefile(t);case 6:return this.geojson=e.sent,e.next=9,this.processHourlyData(t.odFlows);case 9:return e.next=11,this.getDailyDataSummary();case 11:this.marginals=e.sent,this.buildCentroids(this.geojson),this.convertRegionColors(this.geojson),this.addGeojsonToMap(this.geojson),this.setMapExtent(),this.buildSpiderLinks(),this.setupKeyListeners();case 18:this.loadingText="",Qa.a.done();case 20:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"createSpiderLinks",value:function(){var e=this;this.spiderLinkFeatureCollection={type:"FeatureCollection",features:[]};for(var t=0,i=Object.keys(this.linkData);t<i.length;t++){var a=i[t],n=this.linkData[a];if(!(n.daily<=this.lineFilter))try{(function(){var t=e.centroids[n.orig].geometry.coordinates,i=e.centroids[n.dest].geometry.coordinates,r=t[1]-i[1]>0?"#00aa66":"#880033",s=.7,o={id:a,orig:n.orig,dest:n.dest,daily:n.daily,color:r,fade:s};o[_r]=n.daily,n.values.forEach((function(t,i){o[e.headers[i+1]]=t||0}));var l={type:"Feature",properties:o,geometry:{type:"LineString",coordinates:[t,i]}};e.spiderLinkFeatureCollection.features.push(l)})()}catch(r){}}}},{key:"updateSpiderLinks",value:function(){if(this.createSpiderLinks(),this.selectedCentroid)this.fadeUnselectedLinks(this.selectedCentroid);else{var e=this.mymap;e.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}}},{key:"buildSpiderLinks",value:function(){this.createSpiderLinks(),this.mymap.addSource("spider-source",{data:this.spiderLinkFeatureCollection,type:"geojson"}),this.mymap.addLayer({id:"spider-layer",source:"spider-source",type:"line",paint:{"line-color":["get","color"],"line-width":["*",.002*this.scaleFactor,["get","daily"]],"line-offset":["*",.5,["get","daily"]],"line-opacity":["get","fade"]}},"centroid-layer"),this.changedScale(this.currentScale);var e=this;this.mymap.on("click","spider-layer",(function(t){e.clickedOnSpiderLink(t)})),this.mymap.on("mousemove","spider-layer",(function(t){e.mymap.getCanvas().style.cursor=t?"pointer":"grab"})),this.mymap.on("mouseleave","spider-layer",(function(){e.mymap.getCanvas().style.cursor="grab"}))}},{key:"clickedOrigins",value:function(){this.isOrigin=!0,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"clickedDestinations",value:function(){this.isOrigin=!1,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"updateCentroidLabels",value:function(){var e=this.isOrigin?"{dailyFrom}":"{dailyTo}",t=this.isOrigin?"widthFrom":"widthTo";this.mymap.getLayer("centroid-layer")&&this.mymap.removeLayer("centroid-layer"),this.mymap.getLayer("centroid-label-layer")&&this.mymap.removeLayer("centroid-label-layer"),this.showCentroids&&this.mymap.addLayer({id:"centroid-layer",source:"centroids",type:"circle",paint:{"circle-color":"#ec0","circle-radius":["get",t],"circle-stroke-width":3,"circle-stroke-color":"white"}}),this.showCentroidLabels&&this.mymap.addLayer({id:"centroid-label-layer",source:"centroids",type:"symbol",layout:{"text-field":e,"text-size":11},paint:this.showCentroids?{}:{"text-halo-color":"white","text-halo-width":2}})}},{key:"unselectAllCentroids",value:function(){this.fadeUnselectedLinks(-1),this.selectedCentroid=0}},{key:"clickedOnCentroid",value:function(e){e.originalEvent.stopPropagating=!0;var t=e.features[0].properties,i=t.id;i!==this.selectedCentroid?(this.selectedCentroid=i,this.fadeUnselectedLinks(i)):this.unselectAllCentroids()}},{key:"fadeUnselectedLinks",value:function(e){var t,i=this.mymap,a=Object(m["a"])(this.spiderLinkFeatureCollection.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=n.properties.id.split(":"),s=r[0]===String(e)||r[1]===String(e)?.7:Rr;-1===e&&(s=.7),n.properties.fade=s}}catch(o){a.e(o)}finally{a.f()}i.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}},{key:"clickedOnSpiderLink",value:function(e){if(!e.originalEvent.stopPropagating){var t=e.features[0].properties,i=t.daily*this.scaleFactor,a=0,n=t.dest+":"+t.orig;this.linkData[n]&&(a=this.linkData[n].daily*this.scaleFactor);var r=i+a,s="<h1>".concat(r," Bidirectional Trips</h1><br/>");s+="<p> -----------------------------</p>",s+="<p>".concat(i," trips : ").concat(a," reverse trips</p>"),new Za.a.Popup({closeOnClick:!0}).setLngLat(e.lngLat).setHTML(s).addTo(this.mymap)}}},{key:"convertRegionColors",value:function(e){var t,i=Object(m["a"])(e.features);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.properties){var n=this.isOrigin?a.properties.dailyFrom:a.properties.dailyTo,r=n/this.maxZonalTotal,s=128+127*(1-r);s||(s=255),a.properties.blue=s}}}catch(o){i.e(o)}finally{i.f()}}},{key:"handleCentroidsForTimeOfDayChange",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(m["a"])(this.geojson.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=nn["centerOfMass"](n);r.properties.id=n.id;var s=this.calculateCentroidValuesForZone(e,n);r.properties.dailyFrom=s.from*this.scaleFactor,r.properties.dailyTo=s.to*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(35,Math.max(12,Math.pow(this.dailyFrom/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(35,Math.max(12,Math.pow(this.dailyTo/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),n.properties||(n.properties={}),n.properties.dailyFrom=s.from,n.properties.dailyTo=s.to,r.properties.dailyFrom+r.properties.dailyTo>0&&(i.features.push(r),n.properties&&(this.centroids[n.properties[this.idColumn]]=r))}}catch(l){a.e(l)}finally{a.f()}this.centroidSource=i;var o=this.mymap;o.getSource("centroids").setData(this.centroidSource),this.updateCentroidLabels()}},{key:"calculateCentroidValuesForZone",value:function(e,t){var i=0,a=0;if("Alle >>"===e)return i=Math.round(this.marginals.rowTotal[t.id]),a=Math.round(this.marginals.colTotal[t.id]),{from:i,to:a};var n=this.marginals.from[t.id],r=this.marginals.to[t.id];if(Array.isArray(e)){var s=this.headers.indexOf(e[0])-1;s<0&&(s=0);for(var o=this.headers.indexOf(e[1])-1,l=s;l<=o;l++)i+=n?Math.round(n[l]):0,a+=r?Math.round(r[l]):0;return{from:i,to:a}}var c=this.headers.indexOf(e)-1;return i=n?Math.round(n[c]):0,a=r?Math.round(r[c]):0,{from:i,to:a}}},{key:"buildCentroids",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(m["a"])(e.features);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(n.id){var r=nn["centerOfMass"](n);r.properties.id=n.id,r.id=n.id;var s=Math.round(this.marginals.rowTotal[n.id]),o=Math.round(this.marginals.colTotal[n.id]);s||(s=0),o||(o=0),r.properties.dailyFrom=s*this.scaleFactor,r.properties.dailyTo=o*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(70,Math.max(12,Math.sqrt(this.dailyFrom/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(70,Math.max(12,Math.sqrt(this.dailyTo/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),s&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,s)),o&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,o)),n.properties||(n.properties={}),n.properties.dailyFrom=s,n.properties.dailyTo=o,r.properties.dailyFrom+r.properties.dailyTo>0&&(i.features.push(r),n.properties&&(this.centroids[n.id]=r),this.updateMapExtent(r.geometry.coordinates))}}}catch(c){a.e(c)}finally{a.f()}this.centroidSource=i,this.mymap.addSource("centroids",{data:this.centroidSource,type:"geojson"}),this.updateCentroidLabels();var l=this;this.mymap.on("click","centroid-layer",(function(e){l.clickedOnCentroid(e)})),this.mymap.on("mousemove","centroid-layer",(function(e){l.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","centroid-layer",(function(){l.mymap.getCanvas().style.cursor="grab"}))}},{key:"setMapExtent",value:function(){localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:50,bottom:100,right:100,left:300},animate:!1};this.mymap.fitBounds(this._mapExtentXYXY,e)}},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"processShapefile",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Verkehrsnetz bauarbeiten...",e.next=3,Xa["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,i.features.length>150&&(this.lineFilter=10),this.loadingText="Koordinaten berechnen...",e.next=8,Object(je["forEachAsync"])(i.features,(function(e){!a.idColumn&&e.properties&&(a.idColumn=Object.keys(e.properties)[0]),e.properties&&(e.id=e.properties[a.idColumn]);try{"MultiPolygon"===e.geometry.type?a.convertMultiPolygonCoordinatesToWGS84(e):a.convertPolygonCoordinatesToWGS84(e)}catch(t){console.error("ERR with feature: "+e),console.error(t)}}));case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(m["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=[],s=Object(m["a"])(n);try{for(s.s();!(a=s.n()).done;){var o=a.value,l=sn.toLngLat(this.projection,o);r.push(l)}}catch(c){s.e(c)}finally{s.f()}n.length=0,n.push.apply(n,r)}}catch(c){i.e(c)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(m["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=n[0],s=[],o=Object(m["a"])(r);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Object(an["a"])(this.projection,"WGS84",l);s.push(c)}}catch(u){o.e(u)}finally{o.f()}n[0]=s}}catch(u){i.e(u)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(m["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(an["a"])(this.projection,"WGS84",n))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"getDailyDataSummary",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},i={},a={},n={},e.next=6,Object(je["forEachAsync"])(Object.keys(this.zoneData),(function(e){a[e]=Array(s.headers.length-1).fill(0);for(var r=0,o=Object.keys(s.zoneData[e]);r<o.length;r++){var l=o[r];t[e]||(t[e]=0),i[l]||(i[l]=0),s.dailyData[e][l]&&(t[e]+=s.dailyData[e][l],i[l]+=s.dailyData[e][l]),n[l]||(n[l]=Array(s.headers.length-1).fill(0));for(var c=0;c<s.headers.length-1;c++)s.zoneData[e][l][c]&&(a[e][c]+=s.zoneData[e][l][c],n[l][c]+=s.zoneData[e][l][c])}}));case 6:for(r in this.zoneData);return e.abrupt("return",{rowTotal:t,colTotal:i,from:a,to:n});case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processHourlyData",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Uhrzeitdaten entwicklen...",i=t.split("\n"),a=i[0].indexOf(";")>0?";":",",n=i[0].split(a).map((function(e){return e.trim()})),this.rowName=n[0],this.colName=n[1],this.headers=[_r].concat(n.slice(2)),e.next=9,Object(je["forEachAsync"])(i.slice(1),(function(e){var t=e.split(a),i=t.slice(2).map((function(e){return parseFloat(e)})),n=t[0],s=t[1];r.zoneData[n]||(r.zoneData[n]={}),r.zoneData[n][s]=i;var o=i.reduce((function(e,t){return e+t}),0);if(r.dailyData[n]||(r.dailyData[n]={}),r.dailyData[n][s]=o,0!==o){var l=String(t[0])+":"+String(t[1]);r.linkData[l]={orig:t[0],dest:t[1],daily:o,values:i}}}));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this._mapExtentXYXY[0]=Math.min(this._mapExtentXYXY[0],e[0]),this._mapExtentXYXY[1]=Math.min(this._mapExtentXYXY[1],e[1]),this._mapExtentXYXY[2]=Math.max(this._mapExtentXYXY[2],e[0]),this._mapExtentXYXY[3]=Math.max(this._mapExtentXYXY[3],e[1])}},{key:"addGeojsonToMap",value:function(e){this.addGeojsonLayers(e),this.addNeighborhoodHoverEffects()}},{key:"addGeojsonLayers",value:function(e){this.mymap.addSource("shpsource",{data:e,type:"geojson"}),this.mymap.addLayer({id:"shplayer-fill",source:"shpsource",type:"fill",paint:{"fill-color":["rgb",["get","blue"],["get","blue"],255],"fill-opacity":.5}},"road-primary"),this.mymap.addLayer({id:"shplayer-border",source:"shpsource",type:"line",paint:{"line-color":"#66f","line-opacity":.5,"line-width":["case",["boolean",["feature-state","hover"],!1],3,1]}},"centroid-layer")}},{key:"addNeighborhoodHoverEffects",value:function(){var e=this;this.mymap.on("mousemove","shplayer-fill",(function(t){var i=e.mymap;t.features.length>0&&(e.hoveredStateId&&i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=t.features[0].properties[e.idColumn],i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!0}))})),this.mymap.on("mouseleave","shplayer-fill",(function(){var t=e.mymap;e.hoveredStateId&&t.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=null}))}},{key:"offsetLineByMeters",value:function(e,t){try{var i=nn["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"pressedEscape",value:function(){this.unselectAllCentroids()}},{key:"pressedArrowKey",value:function(e){}},{key:"changedTimeSlider",value:function(e){this.currentTimeBin=e;var t=this.currentScale/500*this.scaleFactor;if(0==this.showTimeRange)this.mymap.setPaintProperty("spider-layer","line-width",["*",t,["get",e]]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,["get",e]]);else{var i,a=["+"],n=!1,r=Object(m["a"])(this.headers);try{for(r.s();!(i=r.n()).done;){var s=i.value;s===e[0]&&(n=!0),s!==_r&&(n&&a.push(["get",s]),s===e[1]&&(n=!1))}}catch(o){r.e(o)}finally{r.f()}this.mymap.setPaintProperty("spider-layer","line-width",["*",t,a]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,a])}this.handleCentroidsForTimeOfDayChange(e)}},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedLineFilter",value:function(e){this.lineFilter="Alle"===e?1/0:e,this.updateSpiderLinks()}},{key:"legendRows",get:function(){return["#00aa66","#880033","↓","↑"]}},{key:"scaleRows",get:function(){return[Math.min(Math.round((1200*Math.pow(this.currentScale,-1)+20)*Math.sqrt(this.scaleFactor)),1e3*this.scaleFactor)]}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Ar.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ar.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ar.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Ar.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Ar.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("showTimeRange")],Ar.prototype,"clickedRange",null),Object(w["a"])([Object(O["d"])("showCentroids")],Ar.prototype,"clickedShowCentroids",null),Object(w["a"])([Object(O["d"])("showCentroidLabels")],Ar.prototype,"clickedShowCentroidBubbles",null),Ar=Object(w["a"])([Object(O["a"])({components:{LeftDataPanel:pn,LegendBox:sr,LineFilterSlider:pr,ScaleBox:kr,ScaleSlider:kn,TimeSlider:Tr}})],Ar),p.commit("registerPlugin",{kebabName:"aggregate-od",prettyName:"Origin/Destination Patterns",description:"Depicts aggregate O/D flows between areas.",filePatterns:["viz-od*.y?(a)ml"],component:Ar});var Lr,Mr=Ar,Fr=Mr,Pr=(i("2653"),Object(_["a"])(Fr,Kn,Qn,!1,null,"6559b0eb",null)),Dr=Pr.exports,zr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"container"}},[!e.thumbnail&&e.loadingText?i("div",{staticClass:"status-blob"},[i("p",[e._v(e._s(e.loadingText))])]):e._e(),e.routesOnLink.length>0?i("left-data-panel",{staticClass:"left-panel",attrs:{title:"Transit routes on selected link:"}},[i("div",{staticClass:"dashboard-panel"},[0===e.routesOnLink.length?i("p",{staticClass:"details help-text",staticStyle:{"margin-top":"20px"}},[e._v("Select a link to see the routes traversing it.")]):e._e(),i("div",{staticClass:"route-list"},e._l(e.routesOnLink,(function(t){return i("div",{key:t.uniqueRouteID,staticClass:"route",class:{highlightedRoute:e.selectedRoute&&t.id===e.selectedRoute.id},on:{click:function(i){return e.showRouteDetails(t.id)}}},[i("h3",{staticClass:"mytitle"},[e._v(e._s(t.id))]),i("p",{staticClass:"details"},[i("b",[e._v(e._s(t.departures)+" departures")])]),i("p",{staticClass:"details"},[e._v("First: "+e._s(t.firstDeparture))]),i("p",{staticClass:"details"},[e._v("Last: "+e._s(t.lastDeparture))])])})),0)])]):e._e(),i("div",{staticClass:"map-container",class:{"hide-thumbnail":!e.thumbnail}},[i("div",{attrs:{id:"mymap"}},e._l(e.stopMarkers,(function(e){return i("div",{key:e.i,staticClass:"stop-marker",style:{transform:"translate(-50%,-50%) rotate("+e.bearing+"deg)",left:e.xy.x+"px",top:e.xy.y+"px"}})})),0)]),e.thumbnail?e._e():i("legend-box",{staticClass:"legend",attrs:{rows:e.legendRows}})],1)},Ir=[],Nr=(i("6062"),i("6b0c")),Br=i.n(Nr);(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(Lr||(Lr={}));var Hr=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.call(this,new Br.a)}return Object(y["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Lr.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Lr.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Lr.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(st,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ct),Vr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("p",{staticClass:"title"},[e._v("Legend")]),e._l(e.rows,(function(t){return i("div",{key:t[0],staticClass:"legend-item"},[i("div",{staticClass:"legend-col-1",style:{"background-color":t[0]}}),i("span",{staticClass:"legend-col-2"},[e._v(e._s(t[1]))])])}))],2)},$r=[],qr=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){return Object(g["a"])(this,i),t.apply(this,arguments)}return Object(y["a"])(i,[{key:"created",value:function(){console.log(this.rows)}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({type:Array,required:!0})],qr.prototype,"rows",void 0),qr=Object(w["a"])([O["a"]],qr);var Ur=qr,Yr=Ur,Gr=(i("677a"),Object(_["a"])(Yr,Vr,$r,!1,null,"cb0d8438",null)),Xr=Gr.exports,Wr="EPSG:31468",Jr=16,Zr=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.vizDetails={transitSchedule:"",network:"",projection:"",title:"",description:""},e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.loadingText="MATSim Transit Inspector",e.project={},e.projection=Wr,e.routesOnLink=[],e.selectedRoute={},e.stopMarkers=[],e}return Object(y["a"])(i,[{key:"created",value:function(){this._attachedRouteLayers=[],this._departures={},this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0,this._network={nodes:{},links:{}},this._routeData={},this._stopFacilities={},this._transitLines={},this.selectedRoute=null}},{key:"destroyed",value:function(){p.commit("setFullScreen",!1)}},{key:"authenticationChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this._roadFetcher&&this._roadFetcher.destroy(),this._transitFetcher&&this._transitFetcher.destroy(),this._transitHelper&&this._transitHelper.destroy()}},{key:"mounted",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.setupMap();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(s=r.value,s){e.next=12;break}return e.abrupt("continue",14);case 12:a+=s+"/",t.push({label:s,url:"/"+this.myState.fileSystem.url+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:o=e.sent,l=le.a.parse(o),l.title&&(c=t.pop(),u=c?c.url:"/",t.push({label:l.title,url:u})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),p.commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=le.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.fileSystem.url);case 10:i=this.vizDetails.title?this.vizDetails.title:"Transit Network",this.$emit("title",i),this.projection=this.vizDetails.projection,Qa.a.done();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"setupMap",value:function(){this.mymap=new Za.a.Map({bearing:0,container:"mymap",logoPosition:"bottom-right",style:"mapbox://styles/mapbox/dark-v9",pitch:0});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(console.log({extent:e}),e){var t=JSON.parse(e);this.isMobile();this.thumbnail,this.mymap.fitBounds(t,{animate:!1})}}catch(i){console.log({E:i})}this.mymap.on("load",this.mapIsReady),this.mymap.on("move",this.handleMapMotion),this.mymap.on("zoom",this.handleMapMotion),this.mymap.on("click",this.handleEmptyClick),this.mymap.keyboard.disable(),this.mymap.addControl(new Za.a.NavigationControl,"top-right")}},{key:"handleMapMotion",value:function(){this.stopMarkers.length>0&&this.showTransitStops()}},{key:"handleEmptyClick",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute(),this.removeAttachedRoutes(),this.routesOnLink=[]}},{key:"showRouteDetails",value:function(e){(e||this.selectedRoute)&&(console.log({routeID:e}),e?this.showTransitRoute(e):this.showTransitRoute(this.selectedRoute.id),this.showTransitStops())}},{key:"mapIsReady",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadNetworks();case 2:t=e.sent,t&&this.processInputs(t),this.setupKeyListeners();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"loadNetworks",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,console.log(this.vizDetails),this.myState.fileSystem){e.next=4;break}return e.abrupt("return");case 4:return this.loadingText="Loading networks...",e.next=7,_a.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 7:return this._roadFetcher=e.sent,e.next=10,_a.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.transitSchedule});case 10:return this._transitFetcher=e.sent,t=this._roadFetcher.fetchXML(),i=this._transitFetcher.fetchXML(),e.next=15,Promise.all([t,i]);case 15:return a=e.sent,this._roadFetcher.destroy(),this._transitFetcher.destroy(),e.abrupt("return",{roadXML:a[0],transitXML:a[1]});case 21:return e.prev=21,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Preparing...",e.next=3,Hr.create({xml:t,projection:this.projection});case 3:return this._transitHelper=e.sent,this.loadingText="Crunching road network...",e.next=7,this._transitHelper.createNodesAndLinks();case 7:return this.loadingText="Converting coordinates...",e.next=10,this._transitHelper.convertCoordinates();case 10:return this.loadingText="Crunching transit network...",e.next=13,this._transitHelper.processTransit();case 13:return i=e.sent,this._network=i.network,this._routeData=i.routeData,this._stopFacilities=i.stopFacilities,this._transitLines=i.transitLines,this._mapExtentXYXY=i.mapExtent,this.loadingText="Summarizing departures...",e.next=22,this.processDepartures();case 22:return e.next=24,this.constructDepartureFrequencyGeoJson();case 24:return a=e.sent,e.next=27,this.addTransitToMap(a);case 27:localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY)),this.mymap.fitBounds(this._mapExtentXYXY,{padding:{top:2,bottom:2,right:2,left:2},animate:!1}),this.loadingText="",Qa.a.done();case 31:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addLinksToMap",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.constructGeoJsonFromLinkData(),this.mymap.addSource("link-data",{data:t,type:"geojson"}),this.mymap.addLayer({id:"link-layer",source:"link-data",type:"line",paint:{"line-opacity":1,"line-width":3,"line-color":"#ccf"}});case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processDepartures",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t in this.loadingText="Processing departures",this._transitLines)if(this._transitLines.hasOwnProperty(t)){i=this._transitLines[t],a=Object(m["a"])(i.transitRoutes);try{for(a.s();!(n=a.n()).done;){r=n.value,s=Object(m["a"])(r.route);try{for(s.s();!(o=s.n()).done;)l=o.value,l in this._departures||(this._departures[l]={total:0,routes:new Set}),this._departures[l].total+=r.departures,this._departures[l].routes.add(r.id),this._maximum=Math.max(this._maximum,this._departures[l].total)}catch(c){s.e(c)}finally{s.f()}}}catch(c){a.e(c)}finally{a.f()}}case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addTransitToMap",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.mymap.addSource("transit-source",{data:t,type:"geojson"}),this.mymap.addLayer({id:"transit-link",source:"transit-source",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-color":["get","color"]}}),i=this,this.mymap.on("click","transit-link",(function(e){i.clickedOnTransitLink(e)})),this.mymap.on("mousemove","transit-link",(function(e){i.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","transit-link",(function(){i.mymap.getCanvas().style.cursor="grab"}));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"constructGeoJsonFromLinkData",value:function(){var e=[];for(var t in this._network.links)if(this._network.links.hasOwnProperty(t)){var i=this._network.links[t],a=this._network.nodes[i.from],n=this._network.nodes[i.to],r=[[a.x,a.y],[n.x,n.y]],s={type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{id:t,color:"#aaa"}};e.push(s)}return this._linkData={type:"FeatureCollection",features:e},this._linkData}},{key:"constructDepartureFrequencyGeoJson",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u,h,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i in this.loadingText="Construct departure frequencies",t=[],this._departures)if(this._departures.hasOwnProperty(i)){a=this._network.links[i],n=[[this._network.nodes[a.from].x,this._network.nodes[a.from].y],[this._network.nodes[a.to].x,this._network.nodes[a.to].y]],r=this._departures[i].total,s=.25+.75*(r-1)/this._maximum,o=Math.floor(Jr*s),l=!0,c=Object(m["a"])(this._departures[i].routes);try{for(c.s();!(u=c.n()).done;)h=u.value,"bus"===this._routeData[h].transportMode&&(l=!1)}catch(p){c.e(p)}finally{c.f()}d={type:"Feature",geometry:{type:"LineString",coordinates:n},properties:{width:Math.max(3,.01*this._departures[i].total),color:l?"#a03919":Qr[o],colorBin:o,departures:r,id:i,isRail:l,from:a.from,to:a.to}},d=this.offsetLineByMeters(d,-10),t.push(d)}return t.sort((function(e,t){return e.isRail&&!t.isRail?-1:t.isRail&&!e.isRail?1:0})),e.abrupt("return",{type:"FeatureCollection",features:t});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"offsetLineByMeters",value:function(e,t){try{var i=nn["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"removeStopMarkers",value:function(){this.stopMarkers=[]}},{key:"showTransitStops",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u,h,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.removeStopMarkers(),t=this.selectedRoute,"stopmarker",i=this.mymap.getBearing(),n=Object(m["a"])(t.routeProfile.entries());try{for(n.s();!(r=n.n()).done;)s=Object(pt["a"])(r.value,2),o=s[0],l=s[1],c=[this._stopFacilities[l.refId].x,this._stopFacilities[l.refId].y],o<t.routeProfile.length-1&&(u=nn["point"]([c[0],c[1]]),h=nn["point"]([this._stopFacilities[t.routeProfile[o+1].refId].x,this._stopFacilities[t.routeProfile[o+1].refId].y]),a=nn["bearing"](u,h)-i),d=this.mymap.project([c[0],c[1]]),p={i:o,bearing:a,xy:{x:Math.floor(d.x),y:Math.floor(d.y)}},this.stopMarkers.push(p)}catch(f){n.e(f)}finally{n.f()}case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showTransitRoute",value:function(e){if(e){var t=this._routeData[e];console.log({SELECTED_ROUTE:t}),this.selectedRoute=t;var i=this.mymap.getSource("selected-route-data");i?i.setData(t.geojson):this.mymap.addSource("selected-route-data",{data:t.geojson,type:"geojson"}),this.mymap.getLayer("selected-route")||this.mymap.addLayer({id:"selected-route",source:"selected-route-data",type:"line",paint:{"line-opacity":1,"line-width":5,"line-color":"#097c43"}})}}},{key:"removeSelectedRoute",value:function(){this.selectedRoute&&(this.mymap.removeLayer("selected-route"),this.selectedRoute=null)}},{key:"clickedOnTransitLink",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute();var t,i=e.features[0].properties,a=this._departures[i.id].routes,n=[],r=Object(m["a"])(a);try{for(r.s();!(t=r.n()).done;){var s=t.value;n.push(this._routeData[s])}}catch(o){r.e(o)}finally{r.f()}n.sort((function(e,t){return e.departures>t.departures?-1:1})),this.routesOnLink=n,this.highlightAllAttachedRoutes(),n.length>0&&this.showRouteDetails(n[0].id)}},{key:"removeAttachedRoutes",value:function(){var e,t=Object(m["a"])(this._attachedRouteLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.mymap.removeLayer("route-"+i),this.mymap.removeSource("source-route-"+i)}}catch(a){t.e(a)}finally{t.f()}this._attachedRouteLayers=[]}},{key:"highlightAllAttachedRoutes",value:function(){this.removeAttachedRoutes();var e,t=Object(m["a"])(this.routesOnLink);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.mymap.addSource("source-route-"+i.id,{data:i.geojson,type:"geojson"}),this.mymap.addLayer({id:"route-"+i.id,source:"source-route-"+i.id,type:"line",paint:{"line-opacity":.7,"line-width":8,"line-color":"#ccff33"}}),this._attachedRouteLayers.push(i.id)}}catch(a){t.e(a)}finally{t.f()}}},{key:"pressedEscape",value:function(){this.removeSelectedRoute(),this.removeStopMarkers(),this.removeAttachedRoutes(),this.selectedRoute=null,this.routesOnLink=[]}},{key:"pressedArrowKey",value:function(e){if(this.selectedRoute){var t=this.routesOnLink.indexOf(this.selectedRoute);t+=e,t<0||t>=this.routesOnLink.length||this.showRouteDetails(this.routesOnLink[t].id)}}},{key:"legendRows",get:function(){return[["#a03919","Rail"],["#448","Bus"]]}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],Zr.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Zr.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Zr.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],Zr.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Zr.prototype,"authenticationChanged",null),Zr=Object(w["a"])([Object(O["a"])({components:{LeftDataPanel:pn,LegendBox:Xr}})],Zr),p.commit("registerPlugin",{kebabName:"transit-supply",prettyName:"Transit Routes",description:"The scheduled transit routes on a network",filePatterns:["viz-transit*.y?(a)ml"],component:Zr});var Kr=Zr,Qr=ye()({colormap:"viridis",nshades:Jr}),es=Kr,ts=(i("b950"),Object(_["a"])(es,zr,Ir,!1,null,"259a0118",null)),is=ts.exports,as=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{padding:e.thumbnail?"0 0":"0 20px 20px 20px"},attrs:{id:"container"}},[e.thumbnail?e._e():i("h3",[e._v(e._s(e.title))]),i("div",{staticClass:"vid-container"},[e.movieSource?i("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions}}):e._e()],1)])},ns=[],rs=i("d6d3"),ss=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.movieSource="",e.title="",e.playerOptions={muted:!1,language:"en",playbackRates:[.5,1,1.5,2,5],preload:"metadata",responsive:!0,fluid:!0,playsInline:!0,controls:!0,sources:[]},e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.aspect=0,e}return Object(y["a"])(i,[{key:"destroyed",value:function(){window.removeEventListener("resize",this.onResize),this.thumbnail||p.commit("setFullScreen",!1)}},{key:"mounted",value:function(){if(this.thumbnail||p.commit("setFullScreen",!0),this.yamlConfig){var e=this.getFileSystem(this.$route.name);this.buildMovieSource(e.svn,this.subfolder+"/",this.yamlConfig)}else this.buildRouteFromUrl();this.getVizDetails(),this.thumbnail||this.generateBreadcrumbs(),this.thumbnail||window.addEventListener("resize",this.onResize)}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"buildMovieSource",value:function(e,t,i){this.movieSource="".concat(e,"/").concat(t).concat(i),this.playerOptions.sources.push({type:"video/mp4",src:this.movieSource})}},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length&&(t=p.state.svnProjects.filter((function(t){return t.url===e.substring(8)}))),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n,this.buildMovieSource(t.svn,a,n)}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"onResize",value:function(){var e=document.getElementsByClassName("vid-container")[0],t=document.getElementsByClassName("video-js")[0];this.aspect||(this.aspect=t.clientHeight/t.clientWidth);e.clientWidth;var i=window.innerHeight,a=window.innerWidth;e.style.width="100%",e.style.margin="auto auto";var n=i-120,r=Math.floor(n/this.aspect);t.style.width="".concat(r,"px"),t.style.height="".concat(r*this.aspect,"px"),e.style.width="".concat(r,"px"),e.style.height="".concat(r*this.aspect,"px");var s=a-60;if(t.clientWidth>s){var o=s;t.style.width="".concat(o,"px"),t.style.height="".concat(o*this.aspect,"px"),e.style.width="".concat(o,"px"),e.style.height="".concat(o*this.aspect,"px")}}},{key:"generateBreadcrumbs",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getFileSystem(this.$route.params.project),t){e.next=3;break}return e.abrupt("return",[]);case 3:i=[{label:t.name,url:"/"+t.url}],a=this.myState.subfolder.split("/"),n="/",r=Object(m["a"])(a),e.prev=7,r.s();case 9:if((s=r.n()).done){e.next=17;break}if(o=s.value,o){e.next=13;break}return e.abrupt("continue",15);case 13:n+=o+"/",i.push({label:o,url:"/"+t.url+n});case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](7),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return p.commit("setBreadCrumbs",i),e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[7,19,22,25]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.title=this.myState.yamlConfig.replace(/_/g," "),this.title=this.title.substring(0,this.title.lastIndexOf(".")),this.title&&this.$emit("title",this.title);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],ss.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ss.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ss.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ss.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("yamlConfig")],ss.prototype,"changedYaml",null),Object(w["a"])([Object(O["d"])("subfolder")],ss.prototype,"changedSubfolder",null),ss=Object(w["a"])([Object(O["a"])({components:{"video-player":rs["videoPlayer"]}})],ss),p.commit("registerPlugin",{kebabName:"video-player",prettyName:"Video",description:"",filePatterns:["*.mp4"],component:ss});var os=ss,ls=os,cs=(i("8838"),Object(_["a"])(ls,as,ns,!1,null,"16e5d11d",null)),us=cs.exports,hs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{staticClass:"image-container",class:{zthumbnail:e.thumbnail}},[i("img",{staticClass:"medium-zoom",class:{"invert-colors":e.isDarkMode},attrs:{src:e.myState.imageData}})]):e._e()},ds=[],ps=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.matsimPngTitles={"modestats.png":"Mode statistics","ph_modestats.png":"Passenger hours traveled per mode","pkm_modestats.png":"Passenger km traveled per mode","scorestats.png":"Score statistics","stopwatch.png":"Stopwatch: computation time","traveldistancestatslegs.png":"Leg travel distance","traveldistancestatstrips.png":"Trip travel distance"},e}return Object(y["a"])(i,[{key:"mounted",value:function(){this.yamlConfig||this.buildRouteFromUrl(),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new zt(t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:if(t=e.sent,t){e.next=7;break}return console.log("no blob! :-("),e.abrupt("return");case 7:return e.next=9,fe.a.dataurl(t);case 9:i=e.sent,this.myState.imageData=i,a=this.matsimPngTitles[this.yamlConfig]?this.matsimPngTitles[this.yamlConfig]:this.yamlConfig,this.$emit("title",a),e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](0),console.error({e:e.t0}),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"isDarkMode",get:function(){return this.globalState.colorScheme==a.DarkMode}}]),i}(O["c"]);Object(w["a"])([Object(O["b"])({required:!1})],ps.prototype,"fileApi",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ps.prototype,"subfolder",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ps.prototype,"yamlConfig",void 0),Object(w["a"])([Object(O["b"])({required:!1})],ps.prototype,"thumbnail",void 0),Object(w["a"])([Object(O["d"])("yamlConfig")],ps.prototype,"changedYaml",null),Object(w["a"])([Object(O["d"])("subfolder")],ps.prototype,"changedSubfolder",null),ps=Object(w["a"])([Object(O["a"])({components:{}})],ps),p.commit("registerPlugin",{kebabName:"image-view",prettyName:"Image",description:"",filePatterns:["!(*thumbnail*).(png|jpg)"],component:ps});var ms=ps,fs=ms,vs=(i("7942"),Object(_["a"])(fs,hs,ds,!1,null,"d5524b92",null)),bs=vs.exports,gs={VehicleAnimation:Ui,CarrierViewer:qt,XyHexagons:ca,AgentAnimation:Ua,LinkVolumes:Ln,SankeyDiagram:$n,VegaLite:Zn,AggregateOd:Dr,TransitSupply:is,VideoPlayer:us,ImageView:bs},ys=gs,ks={messages:{en:{Analysis:"Analysis",Files:"Files",Folders:"Folders"},de:{Analysis:"Ergebnisse",Files:"Dateien",Folders:"Ordner"}}},Ss=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.mdRenderer=new ae.a,e.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:null,svnRoot:void 0,subfolder:"",vizes:[],summary:!1},e.summaryYamlFilename="viz-summary.yml",e}return Object(y["a"])(i,[{key:"getFileSystem",value:function(e){var t=p.state.svnProjects.filter((function(t){return t.url===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.svnProject)return[];var e,t=[{label:"aftersim",url:"/"},{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.url}],i=this.myState.subfolder.split("/"),a="/",n=Object(m["a"])(i);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(a+=r+"/",t.push({label:r,url:"/"+this.myState.svnProject.url+a}))}}catch(s){n.e(s)}finally{n.f()}return p.commit("setBreadCrumbs",t),t}},{key:"mounted",value:function(){this.updateRoute()}},{key:"clickedVisualization",value:function(e){var t=this.myState.vizes[e];if("image-view"!==t.component&&this.myState.svnProject){var i="/v/".concat(t.component,"/").concat(this.myState.svnProject.url,"/").concat(this.myState.subfolder,"/").concat(t.config);this.$router.push({path:i})}}},{key:"updateTitle",value:function(e,t){this.myState.vizes[e].title=t}},{key:"swapColors",value:function(){this.fetchFolderContents()}},{key:"updateRoute",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$route.name){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getFileSystem(this.$route.name),this.myState.svnProject=t,this.myState.subfolder=this.$route.params.pathMatch?this.$route.params.pathMatch:"",this.myState.svnProject){e.next=7;break}return e.abrupt("return");case 7:this.myState.svnRoot=new zt(this.myState.svnProject),this.generateBreadcrumbs(),this.fetchFolderContents();case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.updateRoute()}},{key:"filesChanged",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.vizes=[],0!==this.myState.files.length){e.next=3;break}return e.abrupt("return");case 3:if(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),!this.myState.summary){e.next=10;break}return e.next=8,this.buildCuratedSummaryView();case 8:e.next=11;break;case 10:this.buildShowEverythingView();case 11:return e.next=13,this.$nextTick();case 13:Object(ne["a"])(".medium-zoom",{background:"#444450"});case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showReadme",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="readme.md",-1!==this.myState.files.indexOf(t)){e.next=5;break}this.myState.readme="",e.next=11;break;case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);case 9:i=e.sent,this.myState.readme=this.mdRenderer.render(i);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildShowEverythingView",value:function(){var e,t=Object(m["a"])(this.globalState.visualizationTypes.values());try{for(t.s();!(e=t.n()).done;){var i,a=e.value,n=se()(this.myState.files,a.filePatterns),r=Object(m["a"])(n);try{for(r.s();!(i=r.n()).done;){var s=i.value;this.myState.vizes.push({component:a.kebabName,config:s,title:"◆"})}}catch(o){r.e(o)}finally{r.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"buildCuratedSummaryView",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,s,o,l,c,u,h,d,p,f,v,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return e.t0=le.a,e.next=5,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename);case 5:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),i=Object(m["a"])(t.plugins),e.prev=8,i.s();case 10:if((a=i.n()).done){e.next=43;break}if(n=a.value,r=this.globalState.visualizationTypes.get(n),r){e.next=15;break}return e.abrupt("continue",41);case 15:if(!t[r.kebabName]){e.next=38;break}s=Object(m["a"])(t[r.kebabName]),e.prev=17,s.s();case 19:if((o=s.n()).done){e.next=28;break}return l=o.value,e.next=23,this.findMatchingFiles(l);case 23:c=e.sent,u=Object(m["a"])(c);try{for(u.s();!(h=u.n()).done;)d=h.value,this.myState.vizes.push({component:r.kebabName,config:d,title:d})}catch(g){u.e(g)}finally{u.f()}case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t2=e["catch"](17),s.e(e.t2);case 33:return e.prev=33,s.f(),e.finish(33);case 36:e.next=41;break;case 38:p=se()(this.myState.files,r.filePatterns),f=Object(m["a"])(p);try{for(f.s();!(v=f.n()).done;)b=v.value,this.myState.vizes.push({component:r.kebabName,config:b,title:"◆"})}catch(g){f.e(g)}finally{f.f()}case 41:e.next=10;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e["catch"](8),i.e(e.t3);case 48:return e.prev=48,i.f(),e.finish(48);case 51:case"end":return e.stop()}}),e,this,[[8,45,48,51],[17,30,33,36]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"findMatchingFiles",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.myState.files.indexOf(t)>-1)){e.next=2;break}return e.abrupt("return",[t]);case 2:if(i=se()(this.myState.files,t),!i.length){e.next=5;break}return e.abrupt("return",i);case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return",[]);case 7:return e.prev=7,a=t.split("/"),n=this.myState.subfolder+"/"+a[0],console.log(n),e.next=13,this.myState.svnRoot.getDirectory(n);case 13:return r=e.sent,s=se()(r.files,a[1]),e.abrupt("return",s.map((function(e){return a[0]+"/"+e})));case 18:e.prev=18,e.t0=e["catch"](7);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this,[[7,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchFolderContents",value:function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[],e.prev=5,e.next=8,this.myState.svnRoot.getDirectory(this.myState.subfolder);case 8:t=e.sent,i=t.dirs.filter((function(e){return!e.startsWith(".")})).sort(),a=t.files.filter((function(e){return!e.startsWith(".")})).sort(),this.myState.errorStatus="",this.myState.folders=i,this.myState.files=a,e.next=32;break;case 16:e.prev=16,e.t0=e["catch"](5),console.log("BAD PAGE"),console.log({eeee:e.t0}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.t0.status&&(this.myState.errorStatus+="".concat(e.t0.status," ")),e.t0.statusText&&(this.myState.errorStatus+="".concat(e.t0.statusText)),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.t0.url&&(this.myState.errorStatus+="<p>".concat(e.t0.url,"</p>")),e.t0.message&&(this.myState.errorStatus+="<p>".concat(e.t0.message,"</p>")),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e.t0),this.myState.svnProject&&(this.myState.errorStatus+="<p><i>".concat(this.myState.svnProject.svn).concat(this.myState.subfolder,"</i></p>")),this.myState.svnProject&&this.myState.svnProject.need_password&&401===e.t0.status&&p.commit("requestLogin",this.myState.svnProject.url);case 32:return e.prev=32,this.myState.isLoading=!1,e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[5,16,32,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"openOutputFolder",value:function(e){if(!this.myState.isLoading&&this.myState.svnProject){var t="/"+this.myState.svnProject.url+"/"+this.myState.subfolder+"/"+e;this.$router.push({path:t})}}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("globalState.colorScheme")],Ss.prototype,"swapColors",null),Object(w["a"])([Object(O["d"])("$route")],Ss.prototype,"updateRoute",null),Object(w["a"])([Object(O["d"])("globalState.authAttempts")],Ss.prototype,"authenticationChanged",null),Object(w["a"])([Object(O["d"])("myState.files")],Ss.prototype,"filesChanged",null),Ss=Object(w["a"])([Object(O["a"])({components:ys,props:{},i18n:ks})],Ss);var ws=Ss,Os=ws,xs=(i("ebff"),Object(_["a"])(Os,Q,ee,!1,null,"4603c842",null)),js=xs.exports;r["default"].use(f["a"]);var Cs=[{path:"/",name:"Home",component:K},{path:"*",redirect:"/"}];function Ts(){var e,t=[],i=Object(m["a"])(p.state.svnProjects);try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push({path:"/"+a.url,name:a.url,component:js}),t.push({path:"/"+a.url+"/*",name:a.url,component:js})}}catch(n){i.e(n)}finally{i.f()}return t}function _s(){var e,t=[],i=Object(m["a"])(p.state.visualizationTypes.values());try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push({path:"/v/"+a.kebabName+"/:project/*",name:a.kebabName,component:a.component,props:function(e){return{project:e.params.project}}})}}catch(n){i.e(n)}finally{i.f()}return t}var Rs=new f["a"]({mode:"history",base:"/",routes:Ts().concat(_s()).concat(Cs),scrollBehavior:function(e,t,i){return i||{x:0,y:0}}}),Es=Rs,As=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"full-page-app":e.state.isFullScreen,"dark-mode":e.isDarkMode},attrs:{id:"main-app"}},[i("div",{attrs:{id:"nav"}},[e.state.breadcrumbs.length>0?i("div",{staticClass:"breadcrumbs-bar",style:{paddingLeft:e.state.isFullScreen?"0.75rem":""}},[i("nav",{staticClass:"breadcrumb",attrs:{"aria-label":"breadcrumbs"}},[i("ul",e._l(e.state.breadcrumbs,(function(t,a){return i("li",{key:t.label+t.url,on:{click:[function(i){return e.clickedLink(t.url)},function(i){return i.ctrlKey?e.openNewTab(t.url):null},function(i){return i.metaKey?e.openNewTab(t.url):null}],mouseup:function(i){return"button"in i&&1!==i.button?null:e.openNewTab(t.url)}}},[i("p",[e._v(e._s(0===a?"aftersim":t.label))])])})),0)])]):e._e(),i("div",{staticClass:"locale",on:{click:e.toggleTheme}},[i("i",{staticClass:"fa fa-1x fa-adjust"}),i("br"),i("span",[e._v(e._s(e.$t(e.state.colorScheme)))])]),i("div",{staticClass:"locale",on:{click:e.toggleLocale}},[i("i",{staticClass:"fa fa-1x fa-globe"}),i("br"),i("span",[e._v(e._s(e.state.locale))])])]),i("div",{staticClass:"center-area nav-padding"},[i("login-panel",{staticClass:"login-panel"}),i("router-view",{staticClass:"main-content"})],1),e.state.isFullScreen?e._e():i("div",{staticClass:"footer"},[e._m(0),e._m(1),i("p",[e._v("aftersim © 2020 VSP TU-Berlin.")]),e._m(2),i("p",[e._v("EU GDPR: No personal information collected or transmitted.")])])])},Ls=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a",{attrs:{href:"https://vsp.tu-berlin.de"}},[a("img",{attrs:{alt:"TU-Berlin logo",src:i("750d"),width:"225"}})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a",{attrs:{href:"https://matsim.org"}},[a("img",{attrs:{alt:"MATSim logo",src:i("a7f5"),width:"250"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[e._v("More info about VSP:"),i("a",{attrs:{href:"https://www.vsp.tu-berlin.de"}},[e._v(" https://vsp.tu-berlin.de")])])}],Ms=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sidebar-page"},[a("section",{staticClass:"sidebar-layout"},[a("b-sidebar",{attrs:{type:"is-light",fullheight:e.fullheight,fullwidth:e.fullwidth,overlay:e.overlay,right:e.right,open:e.open},on:{"update:open":function(t){e.open=t}}},[a("div",{staticClass:"all-stuff"},[a("div",{staticClass:"block"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"vsp-logo",attrs:{src:i("e046"),alt:"TU Berlin VSP Department"}})])]),a("b-menu-list",{attrs:{label:"Login Required"}}),a("p",{staticClass:"my-label"},[e._v(e._s(e.whichLogin)+": access to this site requires a login.")]),a("b-menu-list",{attrs:{label:"Username"}}),a("b-input",{attrs:{placeholder:"VSP username",maxlength:"30"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("b-menu-list",{attrs:{label:"Password"}}),a("b-input",{attrs:{type:"password","password-reveal":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("b-button",{staticClass:"my-space is-primary",attrs:{disabled:!e.username||!e.password},on:{click:e.clickedLogin}},[e._v("Login")])],1)])],1)])},Fs=[],Ps=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.username="",e.password="",e.expandOnHover=!0,e.fullheight=!0,e.fullwidth=!1,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.right=!1,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e.open=!1,e}return Object(y["a"])(i,[{key:"showLoginPanel",value:function(){this.open=""!==this.globalState.needLoginForUrl}},{key:"panelMayBeClosing",value:function(){this.open||p.commit("requestLogin","")}},{key:"clickedLogin",value:function(){p.commit("setCredentials",{url:this.globalState.needLoginForUrl,username:this.username,pw:this.password}),this.globalState.needLoginForUrl=""}},{key:"whichLogin",get:function(){var e=this;try{var t=this.globalState.svnProjects.filter((function(t){return t.url===e.globalState.needLoginForUrl}))[0];return t.name}catch(i){}return"this site"}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("globalState.needLoginForUrl")],Ps.prototype,"showLoginPanel",null),Object(w["a"])([Object(O["d"])("open")],Ps.prototype,"panelMayBeClosing",null),Ps=Object(w["a"])([Object(O["a"])({components:{},props:{}})],Ps);var Ds=Ps,zs=Ds,Is=(i("920e"),Object(_["a"])(zs,Ms,Fs,!1,null,"2682e7c8",null)),Ns=Is.exports,Bs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sidebar-page"},[a("section",{staticClass:"sidebar-layout"},[a("b-sidebar",{attrs:{position:"static",mobile:e.mobile,"expand-on-hover":e.expandOnHover,reduce:e.reduce,type:e.theme,open:""}},[a("div",{staticClass:"all-stuff"},[a("div",{staticClass:"block"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"vsp-logo",attrs:{src:i("e046"),alt:"TU Berlin VSP Department"}})])]),a("b-menu",{staticClass:"is-custom-mobile"},[a("b-menu-list",{attrs:{label:"Run Browser"}},e._l(e.projects,(function(t){return a("b-menu-item",{key:t.url,attrs:{icon:"folder",label:t.name,active:e.isActive(t)},on:{click:function(i){return e.clickedProject(t)}}})})),1)],1)],1)])],1)])},Hs=[],Vs=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.globalState=p.state,e.expandOnHover=!0,e.fullheight=!0,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e}return Object(y["a"])(i,[{key:"crumbsChanged",value:function(){}},{key:"isActive",value:function(e){var t=this.globalState.breadcrumbs;return!(t.length<2)&&(console.log(t[1]),console.log({item:e}),t[1].label===e.name)}},{key:"clickedProject",value:function(e){var t="/"+e.url;this.$router.push({path:t})}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("globalState.breadcrumbs")],Vs.prototype,"crumbsChanged",null),Vs=Object(w["a"])([Object(O["a"])({components:{},props:{}})],Vs);var $s=Vs,qs=$s,Us=(i("3352"),Object(_["a"])(qs,Bs,Hs,!1,null,"d6946bdc",null)),Ys=Us.exports,Gs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("nav",{staticClass:"navbar is-link",attrs:{role:"navigation","aria-label":"main navigation"}},[i("div",{staticClass:"navbar-brand"},[i("router-link",{staticClass:"home-link navbar-item",attrs:{to:"/"}},[e._v("Home")]),i("a",{staticClass:"navbar-burger burger",class:{"is-active":e.isBurgerActive},attrs:{role:"button","aria-label":"menu","aria-expanded":"false","data-target":"navbarBasicExample"},on:{click:e.clickedBurger}},[i("span",{attrs:{"aria-hidden":"true"}}),i("span",{attrs:{"aria-hidden":"true"}}),i("span",{attrs:{"aria-hidden":"true"}})])],1),i("div",{staticClass:"navbar-menu",class:{"is-active":e.isBurgerActive},attrs:{id:"navbarBasicExample"},on:{click:e.clickedBurger}},[i("div",{staticClass:"navbar-start"},[i("router-link",{staticClass:"navbar-item",attrs:{to:"/avoev/"}},[e._v("AVÖV Project Files")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/public-svn/"}},[e._v("Public SVN")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/serve/"}},[e._v("Localhost")]),i("router-link",{staticClass:"navbar-item",attrs:{to:"/serve/cluster/"}},[e._v("TU Cluster")]),i("div",{staticClass:"navbar-item has-dropdown is-hoverable",class:{"is-active":e.isDropdownActive}},[i("a",{staticClass:"navbar-link"},[e._v(" Etc")]),i("div",{staticClass:"navbar-dropdown"},[i("a",{staticClass:"navbar-item",attrs:{href:"/v9/masks/berlin"}},[e._v("Squirrels")]),i("a",{staticClass:"navbar-item",attrs:{href:"/v9/tracing2/berlin"}},[e._v("Pizza")]),i("a",{staticClass:"navbar-item",attrs:{href:"/v8/masks"}},[e._v("Chicken Wings")])])])],1)])])},Xs=[],Ws=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.isBurgerActive=!1,e.isDropdownActive=!1,e}return Object(y["a"])(i,[{key:"clickedBurger",value:function(){this.isBurgerActive=!this.isBurgerActive}},{key:"mounted",value:function(){}},{key:"routeChanged",value:function(e,t){this.isBurgerActive=!1,this.isDropdownActive=!1}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("$route")],Ws.prototype,"routeChanged",null),Ws=Object(w["a"])([Object(O["a"])({})],Ws);var Js=Ws,Zs=Js,Ks=(i("9668"),Object(_["a"])(Zs,Gs,Xs,!1,null,"656dfc64",null)),Qs=Ks.exports,eo=Za.a;eo.accessToken="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA";var to=function(e){Object(k["a"])(i,e);var t=Object(S["a"])(i);function i(){var e;return Object(g["a"])(this,i),e=t.apply(this,arguments),e.state=p.state,e}return Object(y["a"])(i,[{key:"clickedLink",value:function(e){this.$router.push({path:e})}},{key:"mounted",value:function(){var e=localStorage.getItem("colorscheme")?localStorage.getItem("colorscheme"):(window.matchMedia&&window.matchMedia("(prefers-color-scheme:dark)")).matches?a.DarkMode:a.LightMode;e===a.LightMode&&this.$store.commit("rotateColors");var t=localStorage.getItem("locale")?""+localStorage.getItem("locale"):(navigator.language||navigator.userLanguage).startsWith("de")?"de":"en";this.$store.commit("setLocale",t)}},{key:"toggleLocale",value:function(){var e="en"===this.state.locale?"de":"en";this.$store.commit("setLocale",e),this.$root.$i18n.locale=e}},{key:"toggleTheme",value:function(){this.$store.commit("rotateColors")}},{key:"toggleFullScreen",value:function(e){e?(document.body.classList.add("full-screen-page"),document.documentElement.style.overflowY="auto"):(document.body.classList.remove("full-screen-page"),document.documentElement.style.overflowY=null)}},{key:"isDarkMode",get:function(){return this.state.colorScheme==a.DarkMode}}]),i}(O["c"]);Object(w["a"])([Object(O["d"])("state.isFullScreen")],to.prototype,"toggleFullScreen",null),to=Object(w["a"])([Object(O["a"])({components:{TopNavBar:Qs,SideNavBar:Ys,LoginPanel:Ns,Colophon:E}})],to);var io=to,ao=io,no=(i("5c0b"),i("1a8b")),ro=Object(_["a"])(ao,As,Ls,!1,null,null,null);"function"===typeof no["default"]&&Object(no["default"])(ro);var so=ro.exports,oo=i("289d");r["default"].use(s["a"]),r["default"].use(oo["a"],{defaultIconPack:"mdi",defaultInputHasCounter:!1}),r["default"].config.productionTip=!1;var lo=localStorage.getItem("locale")?""+localStorage.getItem("locale"):(navigator.language||navigator.userLanguage).startsWith("de")?"de":"en",co=new s["a"]({locale:lo,fallbackLocale:"en"});new r["default"]({i18n:co,router:Es,store:p,render:function(e){return e(so)}}).$mount("#app")},ced7:function(e,t,i){},d1ef:function(e,t,i){"use strict";var a=i("5853"),n=i.n(a);t["default"]=n.a},d1f5:function(e,t,i){"use strict";i.r(t),i.d(t,"OrbitControls",(function(){return n})),i.d(t,"MapControls",(function(){return r}));i("d3b7"),i("4c53"),i("ddb0");var a=i("5a89"),n=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new a["x"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a["k"].PAN,MIDDLE:a["k"].DOLLY,RIGHT:a["k"].PAN},this.touches={ONE:a["s"].PAN,TWO:a["s"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(n),i.update(),l=o.NONE},this.update=function(){var t=new a["x"],r=(new a["o"]).setFromUnitVectors(e.up,new a["x"](0,1,0)),s=r.clone().inverse(),f=new a["x"],v=new a["o"];return function(){var e=i.object.position;return t.copy(e).sub(i.target),t.applyQuaternion(r),u.setFromVector3(t),i.autoRotate&&l===o.NONE&&C(x()),i.enableDamping?(u.theta+=h.theta*i.dampingFactor,u.phi+=h.phi*i.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,u.theta)),u.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(i.minDistance,Math.min(i.maxDistance,u.radius)),!0===i.enableDamping?i.target.addScaledVector(p,i.dampingFactor):i.target.add(p),t.setFromSpherical(u),t.applyQuaternion(s),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,p.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),p.set(0,0,0)),d=1,!!(m||f.distanceToSquared(i.object.position)>c||8*(1-v.dot(i.object.quaternion))>c)&&(i.dispatchEvent(n),f.copy(i.object.position),v.copy(i.object.quaternion),m=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",oe,!1),i.domElement.removeEventListener("mousedown",Q,!1),i.domElement.removeEventListener("wheel",ie,!1),i.domElement.removeEventListener("touchstart",ne,!1),i.domElement.removeEventListener("touchend",se,!1),i.domElement.removeEventListener("touchmove",re,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.domElement.removeEventListener("keydown",ae,!1)};var i=this,n={type:"change"},r={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=o.NONE,c=1e-6,u=new a["r"],h=new a["r"],d=1,p=new a["x"],m=!1,f=new a["w"],v=new a["w"],b=new a["w"],g=new a["w"],y=new a["w"],k=new a["w"],S=new a["w"],w=new a["w"],O=new a["w"];function x(){return 2*Math.PI/60/60*i.autoRotateSpeed}function j(){return Math.pow(.95,i.zoomSpeed)}function C(e){h.theta-=e}function T(e){h.phi-=e}var _=function(){var e=new a["x"];return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),p.add(e)}}(),R=function(){var e=new a["x"];return function(t,a){!0===i.screenSpacePanning?e.setFromMatrixColumn(a,1):(e.setFromMatrixColumn(a,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),E=function(){var e=new a["x"];return function(t,a){var n=i.domElement;if(i.object.isPerspectiveCamera){var r=i.object.position;e.copy(r).sub(i.target);var s=e.length();s*=Math.tan(i.object.fov/2*Math.PI/180),_(2*t*s/n.clientHeight,i.object.matrix),R(2*a*s/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(_(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),R(a*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function A(e){i.object.isPerspectiveCamera?d/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){i.object.isPerspectiveCamera?d*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function M(e){f.set(e.clientX,e.clientY)}function F(e){S.set(e.clientX,e.clientY)}function P(e){g.set(e.clientX,e.clientY)}function D(e){v.set(e.clientX,e.clientY),b.subVectors(v,f).multiplyScalar(i.rotateSpeed);var t=i.domElement;C(2*Math.PI*b.x/t.clientHeight),T(2*Math.PI*b.y/t.clientHeight),f.copy(v),i.update()}function z(e){w.set(e.clientX,e.clientY),O.subVectors(w,S),O.y>0?A(j()):O.y<0&&L(j()),S.copy(w),i.update()}function I(e){y.set(e.clientX,e.clientY),k.subVectors(y,g).multiplyScalar(i.panSpeed),E(k.x,k.y),g.copy(y),i.update()}function N(){}function B(e){e.deltaY<0?L(j()):e.deltaY>0&&A(j()),i.update()}function H(e){var t=!1;switch(e.keyCode){case i.keys.UP:E(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:E(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:E(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:E(-i.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),i.update())}function V(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,i)}}function $(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,i)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);S.set(0,a)}function U(e){i.enableZoom&&q(e),i.enablePan&&$(e)}function Y(e){i.enableZoom&&q(e),i.enableRotate&&V(e)}function G(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,a)}b.subVectors(v,f).multiplyScalar(i.rotateSpeed);var n=i.domElement;C(2*Math.PI*b.x/n.clientHeight),T(2*Math.PI*b.y/n.clientHeight),f.copy(v)}function X(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,a)}k.subVectors(y,g).multiplyScalar(i.panSpeed),E(k.x,k.y),g.copy(y)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+a*a);w.set(0,n),O.set(0,Math.pow(w.y/S.y,i.zoomSpeed)),A(O.y),S.copy(w)}function J(e){i.enableZoom&&W(e),i.enablePan&&X(e)}function Z(e){i.enableZoom&&W(e),i.enableRotate&&G(e)}function K(){}function Q(e){if(!1!==i.enabled){var t;switch(e.preventDefault(),i.domElement.focus?i.domElement.focus():window.focus(),e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a["k"].DOLLY:if(!1===i.enableZoom)return;F(e),l=o.DOLLY;break;case a["k"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;P(e),l=o.PAN}else{if(!1===i.enableRotate)return;M(e),l=o.ROTATE}break;case a["k"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;M(e),l=o.ROTATE}else{if(!1===i.enablePan)return;P(e),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",te,!1),i.dispatchEvent(r))}}function ee(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case o.ROTATE:if(!1===i.enableRotate)return;D(e);break;case o.DOLLY:if(!1===i.enableZoom)return;z(e);break;case o.PAN:if(!1===i.enablePan)return;I(e);break}}function te(e){!1!==i.enabled&&(N(),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.dispatchEvent(s),l=o.NONE)}function ie(e){!1===i.enabled||!1===i.enableZoom||l!==o.NONE&&l!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),i.dispatchEvent(r),B(e),i.dispatchEvent(s))}function ae(e){!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan&&H(e)}function ne(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(i.touches.ONE){case a["s"].ROTATE:if(!1===i.enableRotate)return;V(e),l=o.TOUCH_ROTATE;break;case a["s"].PAN:if(!1===i.enablePan)return;$(e),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(i.touches.TWO){case a["s"].DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;U(e),l=o.TOUCH_DOLLY_PAN;break;case a["s"].DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;Y(e),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&i.dispatchEvent(r)}}function re(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),l){case o.TOUCH_ROTATE:if(!1===i.enableRotate)return;G(e),i.update();break;case o.TOUCH_PAN:if(!1===i.enablePan)return;X(e),i.update();break;case o.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;J(e),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;Z(e),i.update();break;default:l=o.NONE}}function se(e){!1!==i.enabled&&(K(),i.dispatchEvent(s),l=o.NONE)}function oe(e){!1!==i.enabled&&e.preventDefault()}i.domElement.addEventListener("contextmenu",oe,!1),i.domElement.addEventListener("mousedown",Q,!1),i.domElement.addEventListener("wheel",ie,!1),i.domElement.addEventListener("touchstart",ne,!1),i.domElement.addEventListener("touchend",se,!1),i.domElement.addEventListener("touchmove",re,!1),i.domElement.addEventListener("keydown",ae,!1),-1===i.domElement.tabIndex&&(i.domElement.tabIndex=0),this.update()};n.prototype=Object.create(a["e"].prototype),n.prototype.constructor=n;var r=function(e,t){n.call(this,e,t),this.mouseButtons.LEFT=a["k"].PAN,this.mouseButtons.RIGHT=a["k"].ROTATE,this.touches.ONE=a["s"].PAN,this.touches.TWO=a["s"].DOLLY_ROTATE};r.prototype=Object.create(a["e"].prototype),r.prototype.constructor=r},d352:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN"}}'),delete e.options._Ctor}},d388:function(e,t,i){"use strict";var a=i("e008"),n=i.n(a);t["default"]=n.a},d429:function(e,t,i){},d469:function(e,t,i){"use strict";var a=i("d6f3"),n=i.n(a);n.a},d6f3:function(e,t,i){},d977:function(e,t,i){e.exports=function(){return new Worker(i.p+"3681d0d877dfa36fcd08.worker.js")}},d9d0:function(e,t,i){"use strict";var a=i("ced7"),n=i.n(a);n.a},e008:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS","pickup":"Pickup","delivery":"Delivery"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN","pickup":"Abholung","delivery":"Lieferung"}}'),delete e.options._Ctor}},e046:function(e,t,i){e.exports=i.p+"img/vsp-logo-left.5106857d.png"},e6d6:function(e,t,i){"use strict";var a=i("8863"),n=i.n(a);n.a},e9b2:function(e,t,i){"use strict";i.r(t),t["default"]="// vertex shader: agent positions\n\nuniform float simulationTime;\nuniform float showSusceptible;\n\nattribute vec3 position2;  // x,y,t\n\n// this gets passed from vertex to fragment shader\nvarying float skip;\nvarying float atRest;\n\nfloat calculateSize() {\n\n    float small = 2.0;\n    float med = 5.0;\n    float big = 8.0;\n\n    // if (myInfectionStatus == 0.0) return small;\n    // else if (myInfectionStatus == 1.0) return big;\n    // else if (myInfectionStatus < 6.0) return med;\n\n    return med;\n}\n\nfloat calculateTimestep(in vec3 point1, in vec3 point2) {\n\n    atRest = 0.0;\n\n    if (point1 == point2) {\n        atRest = 1.0;\n        return 0.0;\n    }\n\n    // position vars have time in the .z to save some space\n    if (simulationTime < position.z) return 0.0;\n    if (simulationTime > position2.z) return 1.0;\n\n    float progress = simulationTime - position.z;\n    float duration = position2.z - position.z;\n\n    return progress / duration;\n}\n\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n\n    if (timestepFraction == 0.0) {\n\n        return point1;\n\n    } else if (timestepFraction >= 1.0 ) {\n\n        return point2;\n\n    } else {\n\n        vec3 direction = point2 - point1;\n\n        return (direction * timestepFraction) + point1;\n    }\n}\n\n\nvoid main() {\n\n    // don't do anything if this trip is currently out of time bounds\n    if (simulationTime < position.z || simulationTime > position2.z) {\n        gl_PointSize = 0.0;\n        gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n        skip = 1.0;\n        return;\n\n    } else {\n\n        // figure out z-index based on whether it is moving\n        float zIndex = atRest == 1.0 ? 0.2 : 0.3;\n\n        // unpack coords from position buffers - x,y,time. Deal w/ z later\n        vec3 point1 = vec3(position.xy, zIndex);\n        vec3 point2 = vec3(position2.xy, zIndex);\n\n        float timestepFraction = calculateTimestep(point1, point2);\n\n        vec3 newPosition = interpolate(point1, point2, timestepFraction);\n\n        gl_PointSize = calculateSize();\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n\n        skip = 0.0;\n   }\n}\n"},ebff:function(e,t,i){"use strict";var a=i("fe15"),n=i.n(a);n.a},ef1a:function(e,t,i){},f0aa:function(e,t,i){"use strict";var a=i("55ea"),n=i.n(a);n.a},f30e:function(e,t,i){"use strict";var a=i("c454"),n=i.n(a);n.a},f863:function(e,t,i){"use strict";i.r(t),t["default"]='#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\n// attribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nuniform float currentTime;\n\nuniform vec2 iconStillOffsets;\n// uniform float iconStillColorModes;\nuniform vec4 iconStillFrames;\n\nattribute float instanceTimestamps;\nattribute float instanceTimestampsNext;\nattribute vec2 instanceStartPositions;\nattribute vec2 instanceEndPositions;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\nvarying float vPercentComplete;\n\nvec2 rotate_by_angle(vec2 vertex, float angle_radian) {\n  // float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n    if (timestepFraction <= 0.0) {\n        return point1;\n    } else if (timestepFraction >= 1.0 ) {\n        return point2;\n    } else {\n        vec3 direction = point2 - point1;\n        return point1 + (direction * timestepFraction);\n    }\n}\n\nvoid main(void) {\n\n  // Calculate progress\n  // (skip everything else if this vertex is outside the time window)\n\n  if (currentTime < instanceTimestamps) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else if (currentTime > instanceTimestampsNext) {\n    vPercentComplete = -1.0;\n    return;\n\n  } else {\n    vPercentComplete = (currentTime - instanceTimestamps) /\n                       (instanceTimestampsNext - instanceTimestamps);\n  }\n\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 startPosition = vec3(instanceStartPositions, 5.0);\n  vec3 endPosition = vec3(instanceEndPositions, 5.0);\n\n  // are we stationary/still\n  bool still = (instanceStartPositions == instanceEndPositions);\n\n  vec2 iconSize = still ? iconStillFrames.zw : instanceIconFrames.zw;\n  // convert size in meters to pixels, then scaled and clamp\n  // project meters to pixels and clamp to limits\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n\n  // figure out angle\n  float angle = 0.0;\n  if (!still) {\n    vec3 point1 = project_position_to_clipspace(startPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 point2 = project_position_to_clipspace(endPosition, vec3(0.0), vec3(0.0)).xyz;\n    vec3 direction = normalize(point2 - point1);\n    angle = atan( direction.y / direction.x);\n    if (direction.x < 0.0) angle = angle - PI;\n  }\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + (still ? iconStillOffsets : instanceOffsets);\n  pixelOffset = rotate_by_angle(pixelOffset, angle) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  vec3 newPosition = interpolate(\n    startPosition,\n    endPosition,\n    vPercentComplete);\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), vec3(0.0));\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(newPosition, offset_common, vec3(0.0));\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec2 upperleft = (still ? iconStillFrames.xy : instanceIconFrames.xy);\n\n  vTextureCoords = mix(\n    upperleft,\n    upperleft + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = still ?  0.0 : 1.0;\n}\n'},fc60:function(e,t,i){"use strict";var a=i("1bf3"),n=i.n(a);n.a},fe15:function(e,t,i){},feb2:function(e,t,i){"use strict";var a=i("5bf4"),n=i.n(a);n.a}});